var shadowFile = 'tracks/koopa_course/k_kage.png'
var cp = [
[-20.666248,202.140408,307.159968,201.105832,15,false],
[-21.994104,165.212232,306.656752,164.554128,15,false],
[-22.392496,127.880584,307.40856,126.986912,0,true],
[-21.397584,59.475440000000006,307.316376,56.164936000000004,16,true],
[-21.794456,-10.028184,307.48412800000006,-10.545776,16,true],
[1.3207280000000001,-58.116072,267.054376,-60.113648000000005,1,true],
[82.20224800000001,-122.603616,183.316144,-121.674648,1,true],
[85.78896,-172.260144,181.880128,-173.62920000000003,1,true],
[85.177992,-206.85,182.175408,-212.55006400000002,1,true],
[82.006208,-238.585936,183.754984,-333.607344,1,false],
[77.480952,-251.95904800000002,99.895776,-336.21656,1,true],
[48.455832,-253.135488,65.33436,-335.282496,1,true],
[-13.898528,-251.129184,58.79572,-340.26431199999996,1,true],
[-15.868680000000001,-307.062248,54.707480000000004,-349.815312,1,true],
[-15.387784,-347.749184,54.127688000000006,-381.973872,2,true],
[-16.500072,-358.459,53.035648,-490.749904,2,true],
[-20.5478,-360.45224800000005,-16.154904000000002,-490.862408,2,true],
[-26.027336,-360.404064,-49.084216,-490.17503200000004,2,true],
[-30.577256000000002,-358.57656000000003,-87.282224,-489.72762400000005,2,true],
[-32.137024000000004,-347.419096,-214.110376,-490.30962400000004,2,true],
[-32.686408,-343.161184,-214.201248,-349.535504,3,true],
[-10.607352,-304.378216,-228.517032,-308.306592,3,true],
[-10.12612,-239.575704,-229.02534400000002,-242.445952,3,false],
[-10.900184,-166.003424,-230.079376,-164.986872,4,true],
[-8.800768,-78.95610400000001,-229.084472,-83.49522400000001,4,true],
[-9.154528,-5.242512,-229.434688,-10.777263999999999,5,true],
[-9.352976,43.128375999999996,-230.37516000000002,39.363552000000006,5,true],
[-8.591520000000001,67.665112,-101.8214,73.498168,5,true],
[-10.002352,92.422496,-103.976152,103.578584,12,true],
[-10.286552,142.441784,-103.123544,131.71444,12,true],
[-8.386888,200.425576,-101.702544,180.028528,12,true],
[-13.296824,239.816888,-136.18172,231.490112,12,true],
[-106.057424,73.18896000000001,-228.798784,62.539744,13,true],
[-97.61249600000001,100.328792,-227.33984,100.44012,11,true],
[-97.25416,124.69604,-226.38956,137.60416800000002,11,true],
[-101.91260000000001,160.53023199999998,-221.030816,199.77160800000001,11,true],
[-70.514344,228.264232,-222.20862400000001,236.90584,11,true],
[-77.963928,249.588672,-130.575768,247.330656,6,true],
[-77.963928,275.10428,-132.156376,266.298,6,true],
[-96.25388000000001,314.168,-133.059592,269.459216,6,true],
[-134.414392,343.748064,-135.995016,271.943064,6,true],
[-204.187168,346.23187199999995,-138.93044,268.556032,7,true],
[-203.283968,266.523816,-139.60784,264.491592,7,true],
[-203.05816800000002,215.944184,-138.93044,258.62075200000004,7,true],
[-159.930016,189.073768,-137.575624,233.105144,7,true],
[-116.35024800000001,185.460936,-128.31775199999998,232.20192000000003,7,true],
[-66.86111199999999,226.65134400000002,-106.640768,252.524096,8,true],
[-46.245176,258.028216,-102.645832,299.114312,8,true],
[-28.28752,283.91056,-99.40802400000001,355.260064,8,true],
[5.13116,304.458528,-95.12487200000001,404.488752,9,false],
[44.420688000000006,341.264248,-66.67383199999999,462.06824800000004,9,true],
[60.00101600000001,361.360592,-9.32016,544.034312,9,true],
[65.860968,365.671128,92.575376,543.2106239999999,10,true],
[68.901672,364.11571999999995,229.35828,542.599064,10,true],
[68.03928,358.13575199999997,307.427,403.73344000000003,10,true],
[48.003944000000004,321.519472,309.154184,321.86490399999997,10,true],
[14.842008,277.303528,309.154184,281.794216,14,true],
[7.93328,228.94234400000002,308.117904,229.633216,14,true]]
var rp = [
[131.999984,76.95472000000001,133.068872,180.00],
[132.0,85.60000000000001,-40.0,180.00],
[1.054448,71.944,-398.552936,-90.00],
[-104.694992,61.024096,-340.563376,0.00],
[-104.292576,42.724904,-195.46516,-12.00],
[-93.404752,43.647096,14.088456,10.00],
[-107.823296,83.360968,301.866936,-30.00],
[-172.62306400000003,92.542904,299.60434399999997,180.00],
[-85.6844,101.75444800000001,302.62372,45.00],
[-9.679943999999999,103.30981600000001,381.878872,45.00],
[132.361016,80.83708800000001,404.14909600000004,-180.00],
[-138.33706400000003,69.820544,183.451216,36.00],
[-71.243616,69.91272000000001,183.637424,-36.00],
[-115.73280000000001,43.63208,14.088456,-10.00],
[132.30278400000003,79.999984,236.812608,180.00],
[131.999984,78.938568,161.36593599999998,180.00],
[131.604408,85.60003200000001,15.979976,180.00]]
var startPos = new THREE.Vector3(132.0,79.999984,206.64000000000001)
var startTheta = 3.141592653589793
var trackFile='./tracks/koopa_course/course.glb'
var collisionFile='./tracks/koopa_course/kcl.glb'
var vrFile='./tracks/koopa_course/vrcorn.glb'
var trackName='koopa_course'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
