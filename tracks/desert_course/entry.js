var shadowFile = 'tracks/desert_course/dc_kage_071023a.png'
var cp = [
[-151.346296,-39.132408000000005,-15.498808,-39.020160000000004,0,false],
[-150.21954399999998,-65.11416799999999,-14.657952,-60.348448,12,false],
[-149.029472,-191.03320000000002,-11.993712,-63.631824,1,true],
[-67.867536,-249.838312,-6.431192,-63.740032,1,true],
[29.795712,-266.09984000000003,-1.551336,-61.688496,2,true],
[113.439096,-266.22212800000005,7.73876,-56.953112000000004,2,true],
[226.76462400000003,-183.17006400000002,13.482040000000001,-51.26097600000001,3,true],
[246.122624,-48.671400000000006,13.560568,-46.486703999999996,3,true],
[223.85884000000001,-5.911416,14.805792,-31.73664,3,true],
[223.858576,-1.74268,14.642263999999999,26.653216,4,true],
[224.831512,5.157768,22.49132,81.06012,4,true],
[225.062768,15.798936,108.786216,100.37532,11,true],
[260.902,121.863328,111.055832,110.44108800000001,11,false],
[232.83531200000002,186.903688,109.87464800000001,143.743656,5,true],
[231.105392,193.249016,89.33552800000001,194.95356,5,true],
[227.569504,254.49124799999998,86.014568,254.61260800000002,5,true],
[205.281888,311.627656,86.07742400000001,311.74944,6,true],
[179.209424,359.19916,101.40761599999999,359.48828000000003,6,true],
[168.97906400000002,403.029688,113.131192,403.16918400000003,6,true],
[169.15764000000001,461.757816,115.225832,427.000496,6,true],
[115.548816,477.848496,97.35488000000001,433.608528,6,true],
[90.42487200000001,484.09312800000004,78.03752,439.54159200000004,6,true],
[80.372704,487.944496,26.89332,451.197816,6,true],
[80.380088,499.51016,27.808495999999998,499.277592,13,false],
[78.336536,601.449872,21.773944,551.588248,13,true],
[19.606168,601.882064,13.436448,551.349064,13,true],
[-73.24076,601.867376,-3.008848,552.36444,13,true],
[-91.82012,494.006032,22.517,495.33716,13,true],
[-96.32247199999999,380.690968,29.251224,382.63724800000006,7,true],
[-64.32872,337.238528,-2.15596,337.190408,7,true],
[-64.104552,275.44956,-1.9506320000000001,275.25787199999996,8,false],
[-110.468736,221.98616,66.81244000000001,221.53960800000002,8,true],
[-135.013952,176.57472,6.003672,67.9328,9,true],
[-205.194264,69.610552,-21.397896,51.693776,9,true],
[-185.700952,-8.018056,-23.137776000000002,35.291048,10,true],
[-153.893312,-24.642928,-14.264168,-24.856104,10,true]]
var rp = [
[-64.8,32.0,-29.6,180.00],
[-61.1782,36.879264000000006,-121.255336,120.00],
[40.865112,46.28187200000001,-158.546,77.00],
[98.32117600000001,13.314368,-59.285656,-14.00],
[110.504848,14.243976000000002,56.263144000000004,77.00],
[138.915112,45.683032,180.991,0.00],
[139.962344,56.047216,373.955592,0.00],
[-32.001568,66.8,379.498968,180.00],
[-32.510632,62.0,248.61548800000003,180.00],
[-45.822456,36.5568,113.53312,-120.00],
[-71.66964,30.827344,20.58944,173.00],
[168.22673600000002,37.996984,130.845608,-18.00],
[-63.975568,32.0,-74.69917600000001,180.00],
[55.198519999999995,60.20323200000001,505.779064,0.00]]
var startPos = new THREE.Vector3(-64.8,32.0,-37.6)
var startTheta = 3.141592653589793
var trackFile='./tracks/desert_course/course.glb'
var collisionFile='./tracks/desert_course/kcl.glb'
var vrFile='./tracks/desert_course/vrcorn.glb'
var trackName='desert_course'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
