var shadowFile = 'tracks/old_obake_sfc/o_shadow.png'
var cp = [
[-246.81392000000002,-60.264,-214.525832,-60.264,0,false],
[-246.945872,-95.18514400000001,-214.77956,-95.197848,13,false],
[-247.78844,-112.751984,-214.816032,-112.95616000000001,12,true],
[-246.607592,-170.367184,-207.966296,-133.57632800000002,12,true],
[-194.193952,-170.349408,-194.04892,-138.633248,1,true],
[-167.50018400000002,-170.39384,-167.550232,-138.6918,1,true],
[-124.053584,-170.310144,-161.645672,-132.603832,1,true],
[-124.030568,-126.97448,-156.025216,-126.961696,2,true],
[-123.83868799999999,-102.60860799999999,-155.82792,-102.57529600000001,2,true],
[-117.756072,-98.455568,-155.76006400000003,-47.613792000000004,2,true],
[-112.401408,-93.017312,-112.378688,-47.487944000000006,3,true],
[-41.410304,-93.052096,-41.374208,-47.627128,3,true],
[-39.126112,-93.18218399999999,0.56828,-47.547184,4,true],
[-39.895792,-144.278856,5.616584,-81.608,4,true],
[8.149752000000001,-144.24928,8.337584000000001,-81.630656,4,true],
[23.269792000000002,-144.19564000000003,23.423104,-81.61654399999999,4,true],
[73.16956,-144.466856,26.563704,-81.61919999999999,4,true],
[73.03719199999999,-77.642048,26.549063999999998,-77.675208,5,true],
[72.584904,-28.399696000000002,26.539232000000002,-28.535216000000002,14,false],
[73.057288,-3.61008,26.482024000000003,-3.5799760000000003,14,true],
[73.118352,44.124808,20.62008,1.896528,14,true],
[14.648536,43.236792,14.411824000000001,8.928136,6,true],
[-34.244800000000005,43.207656,-34.136816,8.947144,6,true],
[-39.1338,46.924944,-78.50458400000001,8.657088,6,true],
[-44.933352,51.272656000000005,-78.320384,51.517824000000005,7,true],
[-44.843048,87.373832,-78.54182399999999,87.39010400000001,7,true],
[-44.85896,133.076672,-84.66183199999999,93.225496,8,true],
[-92.601512,133.082264,-92.93516000000001,98.908568,8,true],
[-140.674328,133.027424,-140.958216,98.923568,9,true],
[-168.42506400000002,106.352504,-168.366144,73.04811199999999,9,false],
[-204.334312,106.36988000000001,-204.350968,72.891912,9,true],
[-246.44090400000002,106.341952,-208.92151199999998,68.29373600000001,10,true],
[-246.47028,50.794864000000004,-216.461128,50.752528,10,true],
[-246.533872,12.214616,-216.405528,12.264744,10,true],
[-246.547392,-24.908968,-216.49288800000002,-24.966784,11,true]]
var rp = [
[-230.879984,20.800024,-50.424,180.00],
[-194.58675200000002,20.800024,-153.813904,90.00],
[-139.463424,20.800024,-129.761064,0.00],
[-113.713624,20.800024,-68.188328,90.00],
[-23.651704000000002,20.800024,-72.934808,135.00],
[48.399336000000005,20.800024,-84.304576,0.00],
[13.079416,20.800008000000002,25.309455999999997,-90.00],
[-60.2076,20.800024,46.883544,0.00],
[-78.565648,20.800024,114.909,-90.00],
[-169.668672,20.800024,91.260728,-90.00],
[-231.15748800000003,20.800024,77.317136,180.00],
[-231.97651199999999,20.800024,-24.01132,180.00],
[-228.38916,20.800024,-135.21634400000002,135.00],
[-230.81708,20.800024,-102.117,180.00],
[39.87796,20.800024,-21.142032,0.00]]
var startPos = new THREE.Vector3(-230.879984,20.800024,-58.424)
var startTheta = 3.141592653589793
var trackFile='./tracks/old_obake_sfc/course.glb'
var collisionFile='./tracks/old_obake_sfc/kcl.glb'
var vrFile='./tracks/old_obake_sfc/vrcorn.glb'
var trackName='old_obake_sfc'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
