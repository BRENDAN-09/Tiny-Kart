var shadowFile = 'tracks/volcano_course/vo_kage_005.png'
var cp = [
[-190.683504,321.598496,-93.83762399999999,321.639472,0,false],
[-190.457936,242.719,-94.271784,242.30916000000002,16,false],
[-190.779016,173.130112,-93.79472,173.222376,1,true],
[-190.421048,131.2,-93.699112,131.179296,1,true],
[-165.39108,82.31744,-131.402904,63.658616,2,true],
[-190.473624,32.488448,-144.230968,31.255712,2,true],
[-200.9232,-7.406168,-150.17660800000002,20.743928,2,true],
[-143.457,-34.873343999999996,-138.54344,15.214272000000001,3,true],
[-64.00708,-27.823568,-64.814736,3.509536,4,true],
[42.661752,-23.289408,14.81432,53.780944000000005,5,false],
[121.049384,20.756,76.8304,51.415544000000004,5,true],
[162.24416,70.26911199999999,84.88446400000001,65.33234399999999,5,true],
[103.21883199999999,144.87135999999998,73.45679200000001,73.60000000000001,5,true],
[43.40128,138.81807999999998,-46.10156,74.05924800000001,5,true],
[36.18408,146.30448800000002,-45.431599999999996,146.474048,5,true],
[45.300992,163.49356,-24.657704000000003,227.888264,5,true],
[83.85803200000001,176.344,16.329448,228.405688,6,false],
[102.28008,300.058376,19.735408,300.289624,17,true],
[102.884616,352.33465600000005,20.416768,351.511408,7,true],
[97.031912,387.41049599999997,24.271696000000002,387.528,7,true],
[126.776224,445.27572,54.834616000000004,483.38815999999997,7,true],
[198.77847200000002,533.9296879999999,106.009032,535.432496,8,true],
[145.523128,664.460128,98.757304,576.139504,8,true],
[43.507847999999996,691.3125600000001,70.93427199999999,583.8395600000001,9,true],
[-5.87608,631.568312,38.030888,584.1078719999999,13,true],
[-54.898112000000005,527.7876239999999,9.256832000000001,528.1863760000001,10,true],
[-56.630032,494.93268800000004,-0.395472,474.47715999999997,10,true],
[-58.123472,481.576752,-41.634167999999995,411.12156,14,true],
[-82.25752,473.845816,-81.929616,437.734528,14,true],
[-118.524688,480.38412800000003,-99.962664,430.908472,12,true],
[-65.281728,593.635504,-65.13964800000001,543.399128,11,true],
[-88.169928,594.086,-75.343952,542.933248,11,true],
[-167.908672,590.735816,-124.7984,547.8456239999999,11,true],
[-201.166528,529.9355039999999,-127.497736,537.721,15,true],
[-170.50095199999998,502.48159200000003,-115.275136,496.01390399999997,15,true],
[-160.64350399999998,483.93406400000003,-121.958544,483.11672,12,true],
[-180.988856,443.10215999999997,-114.458736,416.135032,12,false],
[-189.278768,356.772968,-111.028048,356.971472,0,true]]
var rp = [
[-147.6,24.0,331.6,180.00],
[-146.307376,18.020208,175.41839199999998,180.00],
[-152.51524799999999,25.358112000000002,64.56384,-154.00],
[-147.566968,30.638583999999998,-6.1364399999999995,90.00],
[-24.180712,19.05128,-6.937888,74.00],
[39.597616,30.052536,26.062752,88.00],
[60.246504,30.158032,209.557872,0.00],
[75.318536,9.960192,418.128816,17.00],
[134.433528,18.825896,519.26128,18.00],
[56.73832,23.188496,632.9566239999999,-126.00],
[-33.164856,22.963664,497.345344,171.00],
[-104.19980000000001,29.919712,570.5264960000001,-101.00],
[-147.45616800000002,27.188128000000003,413.673376,-180.00],
[3.06072,19.214976,586.403128,-129.00],
[-36.443768,27.396928,460.789624,-90.00],
[-145.674968,39.319184,533.385688,173.00],
[-151.214144,18.788168000000002,231.881408,180.00],
[61.387488,18.6,317.32528,0.00]]
var startPos = new THREE.Vector3(-147.6,24.0,323.6)
var startTheta = 3.141592653589793
var trackFile='./tracks/volcano_course/course.glb'
var collisionFile='./tracks/volcano_course/kcl.glb'
var vrFile='./tracks/volcano_course/vrcorn.glb'
var trackName='volcano_course'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
