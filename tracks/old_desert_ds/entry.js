var shadowFile = 'tracks/old_desert_ds/dst_shadow.png'
var cp = [
[-243.267704,-81.05156,-32.088024000000004,-83.17103200000001,0,false],
[-243.267704,-102.154448,-33.236984,-102.486512,0,false],
[-243.267704,-123.601944,-33.77956,-125.112712,0,true],
[-243.267704,-145.30264000000003,-34.166760000000004,-144.45420000000001,1,true],
[-242.81718400000003,-176.950832,-35.001936,-177.76521599999998,1,true],
[-242.391968,-201.17644,-36.83432,-204.61756,1,true],
[-241.687528,-229.37107999999998,-39.594688000000005,-227.978424,1,true],
[-232.01132800000002,-288.15756,-39.683472,-238.18376800000001,2,true],
[-157.185064,-334.651344,-47.513239999999996,-252.32935999999998,2,true],
[-129.62750400000002,-363.54844,-47.797776,-253.590952,2,true],
[-53.578,-389.178128,-46.247536000000004,-254.917856,2,true],
[21.445424,-364.999,-45.82296,-252.593112,3,true],
[61.801032,-330.350656,-48.41536,-241.59884,3,true],
[79.330144,-298.26916,-49.852168,-227.778312,3,true],
[87.10056,-284.930496,-51.301616,-154.40721599999998,3,true],
[98.558504,-276.018784,-52.085055999999994,-106.1496,3,true],
[102.100568,-273.633504,53.699248,-107.75244,4,true],
[104.494736,-271.71493599999997,99.46283199999999,-109.4804,4,true],
[110.02195200000001,-271.57075199999997,123.15168,-111.48980800000001,4,true],
[150.764232,-270.76190399999996,128.780952,-111.58664,4,true],
[190.298264,-262.207784,131.412264,-111.219616,4,true],
[225.439624,-237.470112,133.344128,-111.10524000000001,4,true],
[252.258048,-199.554424,135.30464,-109.704968,4,true],
[272.0,-161.29649600000002,135.999968,-107.262632,4,true],
[272.89131199999997,-101.35924800000001,135.694184,-100.733144,4,true],
[272.0,-67.161224,135.694184,-67.33808,4,true],
[272.0,-40.289224000000004,135.694184,-40.741648000000005,6,true],
[272.0,-14.088104,135.694184,-15.958488,6,true],
[272.0,14.936896,135.694184,12.36256,6,true],
[272.0,48.007808,136.09428,52.472568,6,false],
[272.0,106.89623200000001,142.225688,98.659,6,true],
[272.0,148.020688,144.234984,126.929984,6,true],
[272.0,194.58962400000001,149.95088800000002,159.25095199999998,6,true],
[257.055736,226.321168,149.64616,162.941512,7,true],
[216.053544,274.52812800000004,148.91352799999999,163.873704,7,true],
[137.344248,300.099936,147.549472,165.416408,7,true],
[59.385496,254.12684000000002,145.789904,163.23136,7,true],
[42.723023999999995,204.722232,145.458128,158.59556,7,true],
[41.085496,190.22393599999998,147.80857600000002,120.24096000000002,7,true],
[40.181264000000006,188.20160800000002,134.85151199999999,63.08097600000001,8,true],
[39.422168,186.10064000000003,102.58916,28.877655999999998,8,true],
[38.37484,185.153736,59.389432,28.404168000000002,8,true],
[36.56632,183.32588800000002,38.675360000000005,31.557088,9,true],
[21.231024,182.192328,27.298952000000003,40.863760000000006,9,true],
[-15.301232,181.06529600000002,23.404832,41.853504,9,false],
[-68.995864,150.670408,22.471816,41.13796,10,true],
[-83.796,134.464688,21.273168000000002,39.994752,10,true],
[-91.989592,126.921008,7.726192,18.736704000000003,10,true],
[-93.185896,126.00628,-12.538376000000001,-8.73456,10,true],
[-94.326472,125.290784,-36.598536,-26.552400000000002,10,true],
[-123.229648,111.39318399999999,-37.895288,-28.789912,11,true],
[-166.150408,90.18612,-38.279048,-30.3792,11,true],
[-236.285968,42.06969600000001,-38.955392,-32.364008000000005,11,true],
[-242.816608,-0.279616,-39.257584,-35.830944,11,true],
[-243.267704,-22.604392,-35.5372,-44.508,11,false],
[-244.139768,-59.111296,-35.302256,-61.423184,0,true]]
var rp = [
[-123.641664,46.809776,-72.107528,180.00],
[-124.973496,45.239568,-192.953312,180.00],
[-113.6532,47.058888,-289.74318400000004,160.00],
[-0.003016,43.68692,-304.633184,46.00],
[172.295528,44.743568,-193.41416,60.00],
[210.769168,45.617824,-126.399632,0.00],
[206.63372,55.49704800000001,-6.833384000000001,0.00],
[174.118832,48.704952,201.93048800000003,-75.00],
[92.83881600000001,54.941,85.726504,-100.00],
[5.858912,49.957544000000006,134.499128,-116.00],
[-18.839599999999997,45.335456,55.585936000000004,-111.00],
[-116.38807200000001,43.115248,31.455216,-171.00]]
var startPos = new THREE.Vector3(-124.0,46.829752,-77.0)
var startTheta = 3.141592653589793
var trackFile='./tracks/old_desert_ds/course.glb'
var collisionFile='./tracks/old_desert_ds/kcl.glb'
var vrFile='./tracks/old_desert_ds/vrcorn.glb'
var trackName='old_desert_ds'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
