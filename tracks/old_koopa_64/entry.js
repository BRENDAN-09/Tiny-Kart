var shadowFile = 'tracks/old_koopa_64/s64_kage.png'
var cp = [
[-162.025312,90.0,-122.83024800000001,90.0,0,false],
[-162.13745600000001,34.29896,-122.92052000000001,34.408792000000005,1,false],
[-162.02820000000003,-44.08228,-122.95317600000001,-44.08228,1,true],
[-188.430376,-69.76931200000001,-92.60409600000001,-69.664208,1,true],
[-189.06056,-238.185832,-92.830144,-122.588344,1,true],
[-56.874504,-238.349952,-56.196328,-122.61431200000001,1,true],
[-38.646592,-201.800768,-38.555296000000006,-142.215784,1,true],
[47.276288,-201.555816,114.676584,-142.46849600000002,1,true],
[47.155384,-245.735592,114.16203200000001,-245.824184,1,true],
[47.650248,-346.921872,114.16723200000001,-286.941528,1,true],
[189.32644000000002,-347.287528,189.341832,-287.033752,1,true],
[330.196784,-347.027624,295.04784,-286.882816,1,true],
[329.62756,-237.64249600000002,294.82456,-237.70784,1,true],
[329.832816,-121.58824800000001,295.08312800000004,-194.28178400000002,9,false],
[192.48531200000002,-122.08532799999999,140.327936,-194.34834400000003,2,true],
[192.557624,-85.579296,140.35856,-85.579128,2,true],
[192.578752,12.619871999999999,140.59820000000002,-33.951688000000004,2,true],
[93.026008,12.654672000000001,92.89266400000001,-33.58864,2,true],
[53.161648,12.495048,-7.418448000000001,-33.889344,2,true],
[53.036016000000004,22.599968,-7.430072,22.668984000000002,2,true],
[53.113232,32.132312,-7.533816,76.72779200000001,10,false],
[119.238512,32.167728,119.118504,76.8998,10,true],
[220.376392,32.155184,193.975128,76.861272,3,true],
[220.264704,97.02772800000001,193.920952,97.026896,3,true],
[221.634496,166.609232,193.4128,166.60104800000002,8,true],
[222.08072,235.533048,193.50592,235.59375200000002,3,true],
[225.790856,262.51115999999996,197.91872,283.46924800000005,3,true],
[246.995144,273.443216,247.28544,310.958032,3,true],
[267.165968,261.69,298.17118400000004,284.99771999999996,3,true],
[271.257248,239.834952,307.508968,227.15490400000002,3,true],
[254.882472,221.430872,265.95621600000004,184.789904,3,true],
[166.396264,221.86318400000002,166.377,184.525328,4,true],
[148.629968,241.446032,148.670096,178.827608,4,false],
[15.411848,241.358312,15.46068,179.172424,4,true],
[-21.129944,241.912608,-21.081824,211.416936,5,true],
[-58.171648000000005,241.81144,-57.613040000000005,202.74039199999999,5,true],
[-77.119688,241.834888,-77.167576,179.255,5,true],
[-21.271752,208.508576,-20.973704,179.286376,6,true],
[-57.678512000000005,219.33836,-57.9564,179.246688,6,true],
[-77.136472,241.944328,-77.2024,179.256144,6,true],
[-112.93724800000001,241.89728,-112.885744,179.24124799999998,7,true],
[-156.41321599999998,241.83964000000003,-128.562056,179.152904,7,true],
[-156.48675200000002,160.921832,-128.396736,160.725264,7,true]]
var rp = [
[-142.0,62.998056,91.2,180.00],
[-142.285968,62.998056,32.959264000000005,180.00],
[167.291968,64.20039200000001,-117.64624800000001,0.00],
[208.865376,49.320384,89.174856,0.00],
[99.372296,66.55501600000001,202.408624,-90.00],
[-41.170072,62.998056,229.58308,-90.00],
[-41.349624000000006,62.998056,192.10049600000002,-90.00],
[-141.615872,62.998056,214.69095199999998,-180.00],
[208.86534400000002,49.320384,184.73606400000003,0.00],
[300.47072,64.38048,-154.94406400000003,-90.00],
[49.613616,49.320392,53.244672,90.00]]
var startPos = new THREE.Vector3(-142.0,62.998056,91.2)
var startTheta = 3.141592653589793
var trackFile='./tracks/old_koopa_64/course.glb'
var collisionFile='./tracks/old_koopa_64/kcl.glb'
var vrFile='./tracks/old_koopa_64/vrcorn.glb'
var trackName='old_koopa_64'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
