var shadowFile
var cp = [
[-240.8,-293.6,-240.8,-271.2,15,false],
[-203.6,-293.6,-203.20000000000002,-271.2,15,false],
[-168.0,-293.6,-168.0,-271.2,15,true],
[-132.8,-293.6,-132.8,-271.2,0,true],
[-99.2,-310.40000000000003,-99.2,-254.4,0,true],
[-71.2,-310.40000000000003,-71.2,-254.4,0,true],
[-40.0,-310.40000000000003,-40.0,-254.4,0,true],
[-5.6000000000000005,-311.2,-5.6000000000000005,-254.8,1,true],
[19.2,-311.2,19.2,-254.8,1,true],
[44.0,-311.2,44.0,-254.8,1,true],
[72.8,-313.6,75.2,-254.8,1,true],
[88.4,-314.8,110.4,-277.6,1,true],
[90.4,-318.0,131.6,-305.6,1,true],
[92.8,-326.40000000000003,132.4,-334.40000000000003,2,false],
[90.4,-349.6,125.2,-368.8,2,true],
[88.8,-384.8,112.4,-396.40000000000003,2,true],
[82.4,-400.8,93.60000000000001,-420.0,2,true],
[74.8,-408.8,78.8,-425.2,2,true],
[62.4,-408.8,53.2,-422.8,2,true],
[56.800000000000004,-395.2,31.2,-412.0,3,true],
[50.800000000000004,-381.6,16.4,-382.0,3,true],
[51.2,-353.6,16.0,-353.6,3,true],
[51.2,-324.8,16.0,-324.8,3,true],
[52.800000000000004,-305.6,14.4,-305.6,3,true],
[52.800000000000004,-262.4,14.4,-262.4,3,true],
[52.800000000000004,-241.6,14.4,-241.6,4,true],
[59.2,-204.8,8.0,-204.8,4,true],
[59.2,-168.8,8.8,-168.8,4,true],
[58.800000000000004,-133.6,9.200000000000001,-133.6,4,false],
[62.800000000000004,-102.4,3.6,-102.4,5,true],
[87.60000000000001,-54.0,-20.0,-54.0,5,true],
[65.2,-15.6,2.8000000000000003,-15.6,5,true],
[86.4,14.4,-15.6,14.0,6,true],
[74.4,53.2,-4.8,51.6,6,false],
[48.0,100.4,-2.8000000000000003,84.0,6,true],
[24.0,115.60000000000001,-6.8,104.0,7,true],
[6.8,128.4,-9.200000000000001,131.6,7,true],
[16.8,141.6,7.2,156.0,7,true],
[31.2,150.4,22.400000000000002,165.6,7,true],
[48.800000000000004,160.0,36.800000000000004,174.4,7,false],
[59.2,176.0,48.0,182.4,8,true],
[63.2,190.4,54.4,192.0,8,true],
[60.800000000000004,207.20000000000002,52.0,203.20000000000002,8,true],
[52.0,223.20000000000002,41.6,211.20000000000002,8,true],
[28.0,238.4,28.0,212.8,8,true],
[-4.0,236.0,7.2,208.8,8,true],
[-34.4,214.4,-8.0,198.4,8,true],
[-38.0,182.4,-16.4,178.8,8,false],
[-41.6,160.4,-20.8,156.8,8,true],
[-58.800000000000004,109.2,-22.400000000000002,106.8,8,true],
[-66.4,53.6,-26.400000000000002,51.2,8,true],
[-72.8,7.6000000000000005,-34.800000000000004,2.8000000000000003,8,true],
[-84.0,-52.0,-40.4,-56.4,8,true],
[-88.4,-102.0,-45.6,-105.60000000000001,8,true],
[-95.60000000000001,-149.6,-54.4,-154.4,8,true],
[-98.4,-193.6,-64.4,-198.0,9,false],
[-105.60000000000001,-236.4,-67.2,-239.6,9,true],
[-103.2,-276.40000000000003,-59.6,-269.2,9,true],
[-68.0,-313.6,-31.6,-292.40000000000003,9,true],
[-26.400000000000002,-343.2,-4.8,-322.40000000000003,9,true],
[-21.2,-354.8,-5.6000000000000005,-340.8,10,false],
[-24.8,-366.40000000000003,-14.4,-370.40000000000003,10,true],
[-37.2,-376.8,-42.800000000000004,-434.0,10,true],
[-98.8,-360.8,-121.60000000000001,-434.0,10,true],
[-145.6,-363.2,-162.8,-424.8,10,true],
[-293.6,-315.2,-313.6,-381.6,13,true],
[-344.8,-305.6,-355.2,-368.0,13,true],
[-381.6,-309.6,-401.6,-350.40000000000003,14,false],
[-399.6,-293.6,-453.6,-306.8,14,true],
[-391.6,-263.2,-428.8,-218.4,14,true],
[-380.8,-258.4,-387.2,-223.20000000000002,14,true],
[-363.2,-258.4,-355.2,-233.6,14,true],
[-342.40000000000003,-272.0,-328.0,-250.4,14,true],
[-321.6,-292.8,-308.0,-261.6,15,true],
[-292.40000000000003,-297.2,-292.0,-264.0,15,true],
[-267.2,-296.8,-267.2,-264.8,15,true],
[-193.6,-406.40000000000003,-196.8,-422.40000000000003,11,true],
[-223.20000000000002,-384.0,-232.8,-404.0,11,true],
[-252.8,-368.0,-260.8,-389.6,11,true],
[-284.8,-355.2,-293.6,-376.0,11,true],
[-186.4,-346.40000000000003,-190.4,-363.2,12,true],
[-217.6,-344.0,-217.6,-366.40000000000003,12,true],
[-248.8,-340.8,-254.4,-361.6,12,true],
[-279.2,-331.2,-284.0,-354.40000000000003,12,true]]
var cannonDest = new THREE.Vector3(0.0,0.0,0.0)
var cannonDest = new THREE.Vector3(0.0,0.0,0.0)
var cannonDest = new THREE.Vector3(-81.85864,493.689504,-187.09472)
var rp = [
[-128.0,425.309184,-282.0,90.00],
[68.0,245.6,-283.6,94.00],
[116.0,222.0,-341.6,-167.00],
[35.2,164.4478,-386.40000000000003,0.00],
[33.6,122.958208,-182.4,0.00],
[33.6,120.59419199999999,-140.8,0.00],
[40.4,117.85648,-10.0,39.00],
[21.6,112.953776,95.2,-50.00],
[12.0,100.30916800000001,222.4,-102.00],
[-84.8,493.480656,-204.8,-174.00],
[-74.0,457.316752,-416.8,-88.00],
[-236.8,400.011784,-388.0,-57.00],
[-230.4,404.81544,-354.40000000000003,-90.00],
[-324.8,412.051344,-346.40000000000003,-71.00],
[-422.0,435.95409600000005,-293.2,0.00],
[-277.6,431.677592,-282.0,90.00]]
var startPos = new THREE.Vector3(-242.12,431.677592,-282.32)
var startTheta = 1.5707963267948966
var trackFile='./tracks/rainbow_course/course.glb'
var collisionFile='./tracks/rainbow_course/kcl.glb'
var vrFile='./tracks/rainbow_course/vrcorn.glb'
var trackName='rainbow_course'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
