var shadowFile
var cp = [
[160.115,-10.003256,212.65772,-6.152952,0,false],
[162.466672,-21.944848000000004,213.05031200000002,-18.482008,0,false],
[163.197296,-37.456752,219.952112,-39.187432,0,true],
[164.737656,-55.579216,229.442112,-69.382832,0,true],
[160.424032,-79.73554399999999,236.343904,-86.637352,0,true],
[167.325832,-92.676432,231.167544,-111.656408,0,true],
[166.463096,-104.754592,231.167544,-123.734568,0,true],
[163.87492,-121.14638400000001,232.030264,-128.91092,0,true],
[170.776736,-141.85181599999999,236.184424,-134.763376,0,true],
[193.31656,-158.488984,243.194264,-139.077128,0,true],
[209.223504,-169.812576,255.865888,-151.74875200000002,0,true],
[220.81670400000002,-180.866544,267.998312,-165.76844,0,true],
[232.67950399999998,-190.842096,283.366032,-189.494064,0,true],
[237.532472,-203.244128,287.679752,-216.185376,0,true],
[238.88049600000002,-218.07262400000002,281.748344,-236.13647200000003,0,true],
[231.33144000000001,-226.969736,264.762968,-263.097408,0,true],
[227.017704,-233.979576,244.542296,-279.004344,0,true],
[218.659816,-238.56292000000002,222.973544,-286.553408,0,true],
[208.95387200000002,-236.40606400000001,197.630264,-286.553408,0,true],
[198.978328,-233.17075200000002,166.6252,-271.99447200000003,0,true],
[190.350832,-222.38637599999998,146.94375200000002,-248.538472,1,true],
[186.037096,-211.602,135.889768,-228.857,1,true],
[183.610592,-200.008816,130.767192,-209.175512,1,true],
[181.184128,-178.97928,122.94851200000001,-191.381312,1,true],
[49.227752,721.385,-41.737368000000004,703.644872,2,true],
[40.514152,739.5293760000001,-38.685288,723.223624,2,false],
[33.9142,755.835064,-36.355888,737.9764399999999,2,true],
[34.690664,769.81144,-39.461752000000004,749.623376,2,false],
[23.431928,789.9995600000001,-38.685288,758.940936,2,true],
[9.06732,809.022936,-41.791144,765.152688,2,true],
[-3.744352,833.481624,-45.28524,768.6468160000001,2,true],
[-33.638256,846.293312,-47.226400000000005,770.199752,2,true],
[-58.096904,844.7403760000001,-48.779336,769.035064,2,true],
[-72.461512,836.1993120000001,-52.661656,767.482128,2,true],
[-92.649608,817.175816,-57.320448,765.540936,3,true],
[-105.849504,797.7642480000001,-59.64984,760.493872,3,true],
[-122.15528,772.529128,-61.591008,751.952816,3,true],
[-126.037616,752.729248,-60.038072,742.2470000000001,3,true],
[-133.802264,736.811688,-58.873376,732.92944,3,true],
[-142.343376,720.894184,-60.03808,717.788312,4,true],
[-145.061016,694.882688,-52.27344,691.3886239999999,4,true],
[-161.36678400000002,663.435872,-46.449944,657.224184,4,true],
[-163.30793599999998,637.4243120000001,-39.85,630.047872,5,true],
[-168.354984,606.365688,-43.344096,597.82456,5,true],
[-172.237312,569.0953760000001,-52.661680000000004,567.5424399999999,5,true],
[-171.46084,542.307312,-54.991080000000004,545.80144,6,true],
[-179.61373600000002,512.025248,-51.885216,532.601504,6,true],
[-180.778408,480.19016,-51.496984,519.013376,6,true],
[-142.73164000000003,437.096312,-47.614664,511.24875199999997,6,true],
[-96.920192,423.896376,-39.461776,507.366408,6,true],
[-61.59104,416.131784,-28.203032,505.037032,6,true],
[-35.191224000000005,413.802376,-15.003128,504.648784,6,false],
[-10.314832000000001,427.484904,7.51436,503.09584,6,true],
[13.33784,431.66103200000003,38.18472800000001,494.166496,6,true],
[27.314216000000002,430.108128,73.125656,484.46065600000003,6,true],
[43.231744,423.119936,97.531184,468.07815999999997,6,true],
[49.126064,416.137688,116.995928,444.472752,6,true],
[50.643584000000004,404.473,125.53705599999999,414.967064,7,true],
[50.996392,398.273184,121.65472,394.39084,7,true],
[47.114072,393.226128,111.172432,378.861528,7,true],
[39.349416,387.40265600000004,101.07839200000001,368.76750400000003,8,true],
[11.784904000000001,359.83815999999996,85.89408800000001,354.58456,8,true],
[15.278992,329.94421600000004,84.886552,353.407968,8,true],
[29.643592,301.215032,85.505064,352.79328000000004,8,true],
[60.522224,289.672528,88.01838400000001,354.64487199999996,8,true],
[91.69942400000001,296.83484000000004,91.30424000000001,357.64631199999997,8,true],
[105.73716800000001,310.144376,96.243472,365.086752,8,true],
[118.548848,325.285472,119.71112,403.84590399999996,8,true],
[130.58408,337.708936,137.402816,426.62709600000005,8,true],
[137.697752,344.09712800000005,160.51678400000003,431.614408,8,true],
[139.942576,345.547784,212.064032,403.766376,8,true],
[139.547656,343.941184,209.762216,349.62056,9,true],
[136.335544,342.136904,192.36514400000002,322.952312,9,true],
[135.107112,341.05912800000004,164.39890400000002,311.030592,9,true],
[124.37236,331.885472,155.45756,305.992904,9,true],
[111.17245600000001,324.120816,149.1438,305.339064,9,true],
[97.584304,300.82684,142.55072,302.686784,9,true],
[78.17268,271.709408,141.632752,301.63244000000003,9,true],
[76.75162399999999,248.86962400000002,141.204608,300.89056,10,true],
[89.842336,199.066656,141.136984,300.06356,10,true],
[116.19997599999999,175.96265599999998,141.645048,299.597216,10,true],
[147.99351199999998,171.262344,141.94072,299.409784,10,true],
[172.177504,204.28735999999998,142.242984,299.947,10,true],
[177.446032,226.972296,142.53834400000002,300.462472,10,true],
[180.85884,239.61056,143.037232,301.380784,10,true],
[182.214592,251.772816,144.614528,304.204968,10,true],
[182.3092,257.41456,163.88684,318.395784,10,true],
[183.104872,258.58044,199.899672,317.930376,10,true],
[183.520952,256.94384,229.689424,287.563528,10,true],
[183.379296,252.937504,234.90556,255.963264,11,true],
[169.565312,216.27184,238.765768,211.409048,11,true],
[137.998296,178.642016,241.92209599999998,183.178016,11,true],
[119.7644,142.911376,254.585816,149.451424,11,true],
[121.11852,111.380936,259.8632,124.76536800000001,11,true],
[120.450416,83.74708,258.966856,98.76132000000001,11,true],
[119.840304,50.055616,259.32736,66.76326399999999,11,true],
[118.782448,16.761256000000003,259.488296,34.369800000000005,11,true],
[159.49720000000002,-8.309736000000001,213.317736,-4.9651760000000005,11,true]]
var cannonDest = new THREE.Vector3(5.5260240000000005,432.452816,710.1071840000001)
var rp = [
[185.445,53.780176,57.44096,180.00],
[170.96436,106.195416,-230.42016,-22.00],
[-1.372808,421.828408,741.657752,-12.00],
[-68.360512,401.820312,800.093872,-145.00],
[-93.427744,338.416752,702.453504,180.00],
[-97.06652000000001,305.524752,622.197752,180.00],
[-103.030432,293.580528,568.970936,-170.00],
[94.19731200000001,161.28518400000002,394.55612800000006,-145.00],
[176.636952,114.349,375.33444000000003,-162.00],
[148.716856,116.2614,330.84724800000004,-135.00],
[146.46062400000002,95.165832,207.887512,22.00],
[185.080816,53.780176,57.896216,180.00]]
var startPos = new THREE.Vector3(185.714392,50.436904000000006,-6.143216000000001)
var startTheta = 3.0543261909900763
var trackFile='./tracks/old_donkey_gc/course.glb'
var collisionFile='./tracks/old_donkey_gc/kcl.glb'
var vrFile='./tracks/old_donkey_gc/vrcorn.glb'
var trackName='old_donkey_gc'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
