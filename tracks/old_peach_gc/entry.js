var shadowFile
var cp = [
[-128.605368,-36.25896,-77.403304,-36.2944,0,false],
[-127.17144800000001,-110.01483999999999,-67.084232,-110.87326399999999,11,false],
[-123.709912,-175.718768,-66.34802400000001,-175.590816,10,true],
[-146.397424,-304.759936,-37.386552,-220.29342400000002,10,true],
[-33.725663999999995,-311.07984000000005,-27.179792000000003,-223.172576,1,true],
[134.521328,-323.027312,-6.975776,-210.865888,1,true],
[166.99347200000003,-189.99064,-5.0194399999999995,-184.321576,2,false],
[184.257688,-100.05966400000001,-34.94662400000001,-148.63334400000002,2,true],
[102.98926399999999,-65.09760800000001,-75.070968,-91.289584,5,true],
[100.402192,-43.133824000000004,-93.602616,-24.841424,5,true],
[101.5126,-23.542976,-62.509968,46.889736,6,true],
[109.82280800000001,2.518912,17.861672,82.193624,6,true],
[245.68148800000003,118.93632000000001,37.441688,111.40835200000001,7,true],
[213.212968,269.52734399999997,24.665432000000003,121.309904,8,false],
[132.886128,316.00716,-22.262392000000002,159.399936,8,true],
[14.876504,332.178,-36.118456,206.55264000000003,9,true],
[-122.012072,325.260472,-51.888528,210.100112,9,true],
[-144.583112,192.19772,-71.21810400000001,181.268216,9,false],
[-169.97172,116.41243200000001,-71.76495200000001,116.85164,9,true],
[-182.163456,35.90819200000001,-71.96496,36.19128,9,true],
[220.151248,-65.375304,98.02552800000001,-64.17208000000001,3,true],
[216.639248,-45.522352,96.022856,-42.796656000000006,3,true],
[223.27007999999998,-25.864687999999997,95.814408,-21.101952,4,true],
[237.89328,16.025992000000002,105.98096799999999,3.07304,4,true]]
var rp = [
[-90.934408,110.976,-25.52,180.00],
[-25.074944,95.723112,-249.16393599999998,80.00],
[68.615992,86.853496,-178.69892000000002,0.00],
[131.343096,83.538344,-47.305832,-0.00],
[135.286328,83.665616,-19.282671999999998,7.00],
[-6.3858559999999995,84.48,-135.029624,-30.00],
[-32.146936000000004,84.48,36.264568,55.00],
[90.384472,84.48,105.654944,0.00],
[46.205888,84.48,153.7038,-46.00],
[-33.88904,84.48,247.47104800000002,270.00],
[-84.08587200000001,98.940984,-220.937656,142.00],
[-91.583504,107.60154399999999,-118.65187200000001,180.00]]
var startPos = new THREE.Vector3(-90.934408,110.976,-33.52)
var startTheta = 3.141592653589793
var trackFile='./tracks/old_peach_gc/course.glb'
var collisionFile='./tracks/old_peach_gc/kcl.glb'
var vrFile='./tracks/old_peach_gc/vrcorn.glb'
var trackName='old_peach_gc'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
