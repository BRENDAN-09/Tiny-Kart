var cp = [
[-47.063976000000004,-3.0941199999999998,-53.446888,-70.10419999999999,0,false],
[-61.487415999999996,-7.484848,-57.477911999999996,-65.221624,0,true],
[-102.38432,-17.107648,-61.88836,-73.64156,0,true],
[-122.83272000000001,-36.353232000000006,-63.492160000000005,-78.45296,0,true],
[-135.663128,-55.999776,-66.298816,-81.2596,0,true],
[-141.276408,-82.06152,-67.501656,-84.4672,0,true],
[-134.86120000000003,-114.93936000000001,-67.501656,-89.27864,0,false],
[-81.13392,-134.58592000000002,-65.496912,-91.68432000000001,0,true],
[-45.449424,-132.98216,-53.468416,-90.48144,1,true],
[-16.581032,-126.56696000000001,-41.840872000000005,-87.6748,1,true],
[2.847816,-106.07984,-25.821112000000003,-75.991664,1,true],
[18.459608,-91.60344,-15.886328,-63.786080000000005,1,true],
[74.69589599999999,-46.244536000000004,-4.02768,-23.02392,2,true],
[147.89616,20.585544000000002,-6.293112,19.452831999999997,2,true],
[146.76344,37.270552,-4.594032,73.25671200000001,2,true],
[145.961592,87.41560000000001,36.75,86.28288,3,true],
[146.76344,134.092408,57.705192000000004,132.72416,4,true],
[143.861512,177.46631200000002,72.430472,176.9,5,true],
[147.76304800000003,250.876408,77.534832,252.009128,5,true],
[160.222872,335.263592,72.98384,277.76287199999996,6,true],
[147.20584,486.91768800000006,67.33566400000001,283.564872,7,false],
[60.00584,482.11768800000004,43.38784,286.893528,8,true],
[-11.19416,481.31768800000003,-10.65192,291.22887199999997,8,true],
[-152.79416,478.91768800000006,-55.90816,315.186872,9,true],
[-159.39928,313.274,-57.299127999999996,313.98568800000004,9,true],
[-139.07776800000002,205.22464000000002,-56.956048,312.832408,9,true],
[-55.256976,210.88816,-54.69062400000001,313.39871999999997,10,true],
[8.174968,215.98544,0.245976,311.13328,10,true],
[61.412487999999996,217.068408,54.616208,319.62872,10,true],
[64.25733600000001,215.658408,152.59592,327.55768800000004,10,true],
[64.395976,212.22231200000002,149.19776800000002,212.58728,10,true],
[55.74892,174.075048,149.76416,174.64136,11,true],
[42.64112,81.2064,149.19776800000002,65.33454400000001,11,true],
[42.610631999999995,79.92610400000001,147.717688,5.0688,11,true],
[41.775792,79.626344,49.885968,7.8754480000000004,11,false],
[40.915648000000004,80.28792,-27.817743999999998,25.529200000000003,12,true],
[41.067448,81.98912,-34.259784,108.47776,12,true],
[64.320168,128.1604,-4.321592,134.52768799999998,12,true],
[75.145808,222.38359200000002,-4.393056,135.98072,12,true],
[-14.666943999999999,219.17600000000002,-6.144056,136.14000000000001,13,true],
[-82.06216,214.973128,-34.27836,108.41864,13,true],
[-134.16704800000002,209.87584,-28.500512,25.88128,13,true],
[-138.69784,198.54872,-135.86607999999998,67.154008,14,true],
[-296.711376,158.903768,-137.565128,63.189504,14,true],
[-307.47216,36.004392,-137.565128,37.703464000000004,15,true],
[-210.625128,-26.861192,-133.60064000000003,33.738968,15,true],
[-191.93536,-32.52476,-129.63616000000002,-33.657472000000006,15,false],
[-194.2008,-104.45208000000001,-133.034312,-104.45208000000001,16,true],
[-195.33351199999998,-168.450312,-135.86607999999998,-165.61856,16,true],
[-170.41384,-223.386952,-132.46792000000002,-169.58304800000002,16,true],
[-133.60064000000003,-236.979512,-127.37072,-170.71576800000003,16,true],
[-74.133176,-213.19256000000001,-118.68480000000001,-170.4048,16,true],
[-61.29632,-202.100952,-109.21567999999999,-159.608408,16,true],
[-50.79216,-200.04472,-57.608312,-133.48704800000002,16,true],
[-23.126624,-195.634232,-29.541824000000002,-132.284232,16,true],
[15.765504000000002,-180.799128,-25.131376,-129.07656,16,true],
[32.204448,-159.949768,-20.319976,-128.27472,16,true],
[35.412040000000005,-156.34120000000001,4.939856,-108.2272,16,true],
[44.232936,-150.326952,45.034832,-100.6092,17,true],
[104.37544,-135.89272,53.855736,-97.4016,17,true],
[116.40392,-84.17024,56.261432,-83.76928,17,false],
[99.16304,-31.6458,47.039584000000005,-69.33508,17,true],
[41.426288,-5.183112,39.421536,-68.132232,17,true],
[-6.286736,-8.390711999999999,-11.49908,-72.14173600000001,0,true]]
var cannonDest = new THREE.Vector3(57.595248,153.6,14.128)
var rp = [
[-41.662624,20.65416,-37.037776,-88.02],
[-39.988688,48.410160000000005,-115.8408,51.40],
[89.91904,139.78408,35.718208,32.82],
[113.976,127.57168,90.64832000000001,0.00],
[112.4492,127.57168,163.75008,0.00],
[112.85016,112.2184,203.44416,0.00],
[100.01975999999999,72.65352,358.611688,-44.82],
[69.146632,51.58368,401.91424800000004,-99.35],
[-1.019576,27.27888,386.67816,-94.98],
[-104.06367999999999,27.041040000000002,325.332872,179.37],
[-16.656624,27.396400000000003,251.95904800000002,90.88],
[83.98176,27.41488,115.2352,-169.63],
[7.40036,26.90736,87.16872000000001,14.89],
[-43.119312,26.97176,143.30168799999998,-101.41],
[-186.65936,26.600080000000002,119.6456,-140.06],
[-209.11256,26.6,10.186328,116.37],
[-163.8052,19.694080000000003,-151.79736,-178.69],
[59.924784,20.112240000000003,-121.3252,69.38]]
var startPos = new THREE.Vector3(-47.066864,20.9644,-40.930944000000004)
var startTheta = -1.5009831567151233
var trackFile='./tracks/green/course.glb'
var collisionFile='./tracks/green/kcl.glb'
var vrFile='./tracks/green/vrcorn.glb'
var trackName='green'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if((node instanceof THREE.Mesh && node.geometry.attributes.uv2)){
      console.log(`${node.name} has 2 uvs`);
      node.material = flatMat(node.material.map);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
