var shadowFile = 'tracks/treehouse_course/th_shadow_2.png'
var cp = [
[62.800000000000004,-225.578688,98.374624,-225.578688,15,false],
[64.067984,-283.721064,129.853128,-289.60744,1,false],
[47.301896,-320.67159200000003,113.45216800000001,-379.30316,20,true],
[-10.169167999999999,-372.17887199999996,43.562288,-411.74415999999997,2,true],
[-27.572344,-369.909344,-27.6448,-444.04,3,false],
[-35.098432,-364.356216,-88.65492,-396.999248,4,true],
[-33.331952,-328.922096,-82.76703200000001,-328.892,4,true],
[-33.195968,-261.770704,-79.87224800000001,-259.763672,4,true],
[-32.49172,-190.50384,-76.8756,-188.688328,5,true],
[-30.898080000000004,-115.96016,-75.70564,-111.81336,5,true],
[-32.95232,-37.112767999999996,-71.404432,-34.894632,5,true],
[-31.843816,40.465848,-66.648376,41.702664,5,true],
[-30.959256000000003,112.09578400000001,-65.77923200000001,113.288504,5,true],
[-30.878664,167.350392,-65.801736,167.86356,5,true],
[-21.064584,221.47776800000003,-73.46212799999999,221.004232,5,false],
[-25.114984,265.625784,-68.614496,264.68824800000004,5,true],
[-45.829592,312.617096,-75.842352,286.640688,6,true],
[-85.388144,349.636096,-95.47431200000001,310.710184,6,true],
[-147.98431200000002,343.19644,-110.01844,303.938624,6,true],
[-146.369264,280.26524800000004,-104.212016,284.66,7,false],
[-137.64706400000003,240.517736,-88.444728,245.364984,7,true],
[-130.47233599999998,199.1138,-77.597976,203.273624,8,true],
[-122.578216,168.95251199999998,-70.359128,162.35054399999999,9,true],
[-127.866336,161.96196799999998,-99.581912,126.12048,9,true],
[-133.72206400000002,161.863936,-148.0598,125.986248,9,true],
[-141.499032,166.80700000000002,-177.086096,155.25090400000002,10,false],
[-141.95000000000002,181.56734400000002,-178.532496,199.52888800000002,10,true],
[-51.955336,173.555216,-188.244704,241.004544,10,true],
[-5.73596,183.75420000000003,-191.395096,279.604968,10,true],
[16.248368,212.306496,-172.716856,306.36078399999997,10,true],
[20.734432,247.0012,-153.724488,331.392624,10,true],
[21.552560000000003,279.408968,-125.88047999999999,345.289936,10,true],
[15.420152,316.27631199999996,-71.416912,350.262064,11,false],
[17.842696,384.83224800000005,-51.701767999999994,378.752528,11,true],
[-12.81824,446.924096,-57.702232,382.31884,11,true],
[-85.281904,442.936624,-79.51952,374.055592,11,true],
[-133.141144,416.620816,-132.68428,355.738688,12,true],
[-172.64387200000002,414.969784,-179.92552799999999,373.911688,12,true],
[-203.116904,428.745528,-219.35056,406.321936,12,true],
[-249.127264,450.60872,-239.44388800000002,421.404624,12,true],
[-282.251096,396.478528,-241.54836,413.459624,12,false],
[-228.327784,350.388872,-200.29972,388.308344,13,true],
[-192.28451199999998,322.133408,-159.606016,356.984,13,true],
[-153.20660800000002,292.31984000000006,-118.40176,329.173816,13,true],
[-119.099352,263.644408,-81.82391199999999,304.67762400000004,14,true],
[-81.069912,234.813312,-47.939552000000006,275.307248,14,true],
[-43.050976000000006,215.348456,-21.145384,234.864968,16,true],
[4.294952,160.823128,47.2824,223.02418400000002,16,false],
[57.595704,129.576048,104.592,151.49079999999998,17,true],
[42.968776,105.46440799999999,136.370424,105.575872,17,true],
[38.389911999999995,65.955112,136.787216,65.985632,18,true],
[33.399128,17.435728,138.735048,16.899736,18,true],
[34.648528,-43.336384,143.50331200000002,-42.481232000000006,18,false],
[40.089472,-100.870632,152.12536,-100.87060799999999,18,true],
[50.581576000000005,-168.84581599999999,164.97536,-168.64016800000002,19,true]]
var cannonDest = new THREE.Vector3(-52.10532,172.75756,198.34731200000002)
var rp = [
[85.60000000000001,74.568,-216.378688,180.00],
[106.062368,88.11768,-329.625816,-160.00],
[15.539368000000001,46.46187200000001,-384.425624,-155.00],
[-23.545504,37.068184,-413.85044,-75.00],
[-55.168328,29.346176,-389.53644,-5.00],
[-51.805552000000006,160.622592,232.66962400000003,0.00],
[-63.794272,175.547784,301.568904,-45.00],
[-116.419904,183.302392,255.091032,170.00],
[-105.926232,187.75984,199.55428,180.00],
[-112.494992,204.39764000000002,147.132872,-90.00],
[-158.107888,214.375832,188.63416,35.00],
[-35.855232,223.000576,336.847872,25.00],
[-155.793736,210.642168,389.09734399999996,-65.00],
[-198.51356,219.330488,360.576248,130.00],
[-99.19765600000001,185.849528,283.182064,130.00],
[86.077544,74.33268,-259.95632800000004,180.00],
[9.301848,164.363832,196.704264,120.00],
[82.3996,140.931856,133.878392,175.00],
[85.359928,82.826496,-11.849664,180.00],
[85.049688,74.569224,-183.615184,180.00],
[66.961872,62.678208,-348.706496,-105.00]]
var startPos = new THREE.Vector3(85.60000000000001,74.568,-224.378688)
var startTheta = 3.141592653589793
var trackFile='./tracks/treehouse_course/course.glb'
var collisionFile='./tracks/treehouse_course/kcl.glb'
var vrFile='./tracks/treehouse_course/vrcorn.glb'
var trackName='treehouse_course'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
