var shadowFile = 'tracks/old_koopa_gba/kpa_shadow.png'
var cp = [
[184.4,-110.504,227.600016,-110.504,1,false],
[184.4,-152.0,227.6,-152.0,1,true],
[184.2858,-169.02048800000003,220.503328,-228.16316,1,false],
[168.0,-169.20000000000002,168.0,-228.40001600000002,1,true],
[134.4,-169.20000000000002,134.4,-228.40001600000002,1,true],
[98.8,-173.6,98.8,-228.40001600000002,1,true],
[60.4,-186.8,60.4,-228.40001600000002,2,true],
[27.736048,-183.436752,-11.676191999999999,-228.14688800000002,2,true],
[27.6,-158.4,-20.400000000000002,-158.4,3,false],
[27.6,-120.00000800000001,-20.400000000000002,-120.00000800000001,3,true],
[27.687072,-48.718376,-22.128616,-103.27028,3,true],
[-32.277832,-48.906088000000004,-32.397144000000004,-92.454344,3,true],
[-65.2,-48.800000000000004,-65.2,-92.400008,4,true],
[-93.2,-48.800000000000004,-93.2,-92.400008,4,true],
[-153.33603200000002,-48.647632,-107.86390399999999,-100.206888,4,true],
[-153.6,-124.800008,-108.0,-124.800008,5,false],
[-153.730592,-144.329264,-107.970032,-193.181016,5,true],
[-179.6,-144.39456,-179.6,-193.180968,5,true],
[-211.815,-144.789112,-256.457128,-193.180936,6,true],
[-212.209544,-128.4,-256.062608,-128.4,6,true],
[-211.6,-80.00000800000001,-264.0,-80.00000800000001,7,true],
[-211.6,-36.4,-270.4,-36.4,8,true],
[-212.0,8.0,-280.0,8.0,9,true],
[-220.00001600000002,47.6,-284.0,47.6,10,false],
[-240.480016,84.0,-289.6,84.0,11,true],
[-248.960016,110.400008,-289.6,110.400008,19,true],
[-254.800016,144.0,-289.6,144.0,19,true],
[-254.800016,182.4,-289.6,182.4,19,true],
[-254.800016,218.00001600000002,-289.6,218.00001600000002,19,true],
[-254.800016,252.00001600000002,-289.6,252.00001600000002,19,true],
[-251.200016,258.000016,-289.6,308.40000000000003,19,true],
[-239.891704,258.069296,-239.740888,308.24372,19,true],
[-230.40001600000002,258.000016,-177.6,308.40000000000003,19,true],
[-225.491408,250.800016,-177.6,250.800016,18,true],
[-225.491408,218.00001600000002,-177.6,218.00001600000002,18,true],
[-225.491408,182.4,-177.6,182.4,18,true],
[-225.491408,144.0,-177.6,144.0,18,true],
[-225.491408,88.78828,-177.452968,127.54292,12,true],
[-168.0,88.78828,-168.0,120.4,12,false],
[-130.8,85.60000000000001,-130.8,120.4,13,true],
[-89.60000000000001,81.60000000000001,-89.60000000000001,120.4,14,true],
[-42.0,78.0,-42.0,120.4,14,true],
[3.2,75.2,3.2,120.4,15,true],
[76.4802,72.216184,24.0,148.8,15,true],
[112.40296000000001,118.40675999999999,48.0,177.6,15,true],
[134.4,163.20000000000002,72.0,216.00001600000002,15,true],
[172.8,182.4,105.600008,244.800016,15,true],
[172.8,225.600016,134.4,273.6,15,true],
[182.4,225.600016,225.600016,273.6,16,false],
[184.4,220.800016,228.00001600000002,220.800016,16,true],
[184.0,187.20000000000002,228.40001600000002,187.20000000000002,16,true],
[182.8,148.8,228.40001600000002,148.8,16,true],
[182.8,110.400008,228.40001600000002,110.400008,16,true],
[182.8,72.8,228.40001600000002,72.8,16,true],
[182.8,30.0,228.40001600000002,30.0,16,true],
[182.8,-5.2,228.40001600000002,-5.2,17,false],
[182.8,-42.0,228.40001600000002,-42.0,17,true],
[183.20000000000002,-80.0,228.00001600000002,-80.0,17,true]]
var rp = [
[204.5962,28.8,-101.304,180.00],
[168.8,28.8,-204.00001600000002,-90.00],
[81.621696,28.8,-204.906968,-90.00],
[-13.907792,28.8,-73.109648,-90.00],
[-56.709568,28.8,-72.87603999999999,-90.00],
[-128.0,28.8,-136.0,-180.00],
[-234.64248800000001,28.8,-143.958688,0.00],
[-234.64248800000001,28.8,-106.636616,0.00],
[-235.200016,28.799992,-62.4,0.00],
[-246.273704,28.799992,-19.898552,0.00],
[-257.797128,28.799992,22.175768,0.00],
[-264.83244,28.799992,61.562664,0.00],
[-184.476528,28.8,101.55024800000001,90.00],
[-142.591576,28.8,101.880056,90.00],
[-104.334496,28.8,101.88004,90.00],
[61.2,28.8,104.8,25.00],
[205.34073600000002,28.8,142.081144,180.00],
[204.0,28.8,-36.0,180.00],
[-201.62752799999998,28.8,240.184112,180.00],
[-267.967936,28.8,116.106288,0.00]]
var startPos = new THREE.Vector3(204.5962,28.8,-109.304)
var startTheta = 3.141592653589793
var trackFile='./tracks/old_koopa_gba/course.glb'
var collisionFile='./tracks/old_koopa_gba/kcl.glb'
var vrFile='./tracks/old_koopa_gba/vrcorn.glb'
var trackName='old_koopa_gba'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
