var cp = [
[167.67936,715.183184,317.59212800000006,712.174,0,false],
[175.895688,676.624,317.65428,677.9736879999999,0,true],
[182.27048800000003,647.335064,316.344472,648.15056,0,true],
[181.30816000000002,611.175064,316.344472,612.7184960000001,16,true],
[179.58792000000003,561.222,318.61912800000005,561.2493760000001,1,true],
[178.65504800000002,539.699376,333.89871999999997,501.76224800000006,2,true],
[165.40816,529.522872,311.649688,441.780408,2,true],
[148.224872,529.0451280000001,265.129184,409.753688,3,false],
[131.801128,526.794,207.66231200000001,397.656408,3,true],
[106.17624,524.010096,134.7612,418.742408,4,true],
[80.78367999999999,487.17887199999996,80.2868,417.05087199999997,4,true],
[44.273480000000006,489.773752,43.980088,412.64744,4,true],
[7.732352,490.298,8.227152,410.197128,5,true],
[-43.822296,487.00271999999995,-11.281128,398.560312,5,true],
[-132.802,482.782968,-8.767719999999999,378.334312,6,false],
[-181.96592,411.27728,13.122048000000001,357.507128,6,true],
[-185.863512,341.11144,14.548008,343.33862400000004,6,true],
[-182.03176800000003,282.211032,15.140624,332.825032,7,true],
[-179.337512,222.06320000000002,17.49604,323.13656000000003,7,true],
[-153.15592,164.076232,19.761727999999998,310.275184,7,true],
[-88.78367999999999,108.13248,25.269112,300.974872,8,true],
[21.167568,90.40256,33.521184000000005,299.27272,8,false],
[102.45888000000001,77.674352,40.878023999999996,299.12528000000003,9,true],
[201.004488,85.97976,49.902984,300.890312,9,true],
[273.11744,144.58984,55.281584,309.07390399999997,9,true],
[294.088408,245.61464,54.387976,318.25471999999996,10,true],
[283.19016,329.937752,54.795808,328.29944,10,true],
[252.590408,374.89544,61.78024,342.259032,10,true],
[185.464,400.399688,59.7462,346.32984000000005,11,false],
[140.825768,420.488312,53.03592,347.04887199999996,11,true],
[99.32392,435.03256,46.764992,345.432816,11,true],
[46.015016,433.68912800000004,33.724392,346.34728,11,true],
[24.312536,432.00144,21.249295999999998,346.465592,12,true],
[-3.6694160000000005,429.602096,-29.274368,352.12615999999997,12,true],
[-10.003904,442.41015999999996,-51.769768,391.66768800000006,12,true],
[-11.362191999999999,462.105904,-83.70360000000001,410.195528,12,false],
[-11.976936,476.26575199999996,-96.92576,454.402872,13,true],
[-2.504032,483.922248,-83.66152000000001,510.58609600000005,13,true],
[18.92796,491.394968,-59.333752000000004,545.0583760000001,13,true],
[46.03955200000001,496.732312,-23.606648,567.147184,14,true],
[71.14253599999999,502.181528,22.191288,588.86,14,true],
[100.63680000000001,510.07862400000005,59.221656,598.32456,14,true],
[128.21944,519.27072,89.20376,609.588624,15,false],
[159.77728,525.902936,124.27408,623.5161840000001,15,true],
[191.04784,532.997752,157.92072000000002,636.1383760000001,15,true],
[234.910952,551.563688,208.295592,653.608248,16,true],
[283.921528,559.116752,269.202,654.474184,16,true],
[328.080408,564.23656,297.36118400000004,656.394184,17,true],
[374.15918400000004,587.275816,317.12009600000005,662.245872,17,true],
[412.55816,622.475064,315.64384,678.071816,18,false],
[436.237528,671.753624,319.022904,711.618,18,true],
[442.637376,740.871816,319.66724800000003,742.683872,19,true],
[431.757592,820.229624,313.301872,771.0113120000001,19,true],
[383.118872,887.428,314.000816,795.2703120000001,20,true],
[263.03984,946.9,303.121032,798.4703760000001,20,true],
[168.91744,862.332816,290.961376,797.190376,21,true],
[167.02592,787.324376,301.201032,767.7511840000001,21,true],
[171.290488,743.884872,317.20072,743.431752,21,true]]
var rp = [
[248.614,198.35144,677.401936,180.00],
[247.71,184.976,583.385936,180.00],
[251.326,197.62472,496.601904,-155.00],
[170.87,201.83728,449.593904,-90.00],
[83.18208,214.414952,450.497904,-90.00],
[-7.217944,200.49631200000002,448.689904,-111.00],
[-56.033944000000005,209.75856,376.36990399999996,180.00],
[-50.609944000000006,230.424232,251.61792000000003,135.00],
[4.534056,228.97008,222.68992000000003,90.00],
[100.358,228.53207999999998,235.34592,40.00],
[118.438,227.33768799999999,326.649904,0.00],
[72.334064,228.79456,401.681904,-90.00],
[-17.161944,227.0188,408.009904,-55.00],
[-35.241944000000004,228.882312,498.409904,55.00],
[47.022056,218.66984,539.089936,70.00],
[132.90200000000002,202.747688,571.633936,70.00],
[250.422,200.637128,608.697936,85.00],
[323.646,200.89487200000002,617.737936,60.00],
[371.558,203.762408,679.209936,25.00],
[372.462,203.44208,772.321936,-25.00],
[317.318,204.55016,842.833624,-60.00],
[244.094,200.9472,790.401936,175.00]]
var startPos = new THREE.Vector3(248.354408,200.58808,713.5423760000001)
var startTheta = 3.141592653589793
var trackFile='./tracks/waluigi/course.glb'
var collisionFile='./tracks/waluigi/kcl.glb'
var vrFile='./tracks/waluigi/vrcorn.glb'
var trackName='waluigi'
var numLaps = 3
var floorName = []
var wallName = []
var water, swater, cube, boost
var boosts = []
var materials = [];
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000)
//camera.layers.set(5)

//Initiate the THREE js context
scene = new THREE.Scene()

var shadowTex = texLoad.load('./tracks/waluigi/shadow.png')


loader = new THREE.GLTFLoader()
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(node instanceof THREE.Mesh)console.log(node.geometry.attributes);
    if((node instanceof THREE.Mesh && node.geometry.attributes.uv2)){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowTex);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root);
  count(3)
  finalize();
  animate()
});

loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){
  scene.getObjectByName("water").material = waterMat;
  scene.getObjectByName("boost").material = boostMat;
  //scene.getObjectByName("rainbow").material = boostMat;
}

function update(){
  waterMat.uniforms.time.value+=0.01;
  boostMat.uniforms.time.value+=0.01;

}
