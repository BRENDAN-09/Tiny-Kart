var shadowFile = 'tracks/old_sherbet_64/s64_shadow.png'
var cp = [
[262.78156,7.94984,295.28521600000005,7.94984,18,false],
[262.78156,-40.54108,297.38016,-27.727304,18,true],
[294.277312,-80.339272,328.99256,-55.648088,1,false],
[313.256184,-91.973352,370.03328000000005,-91.95674400000001,1,true],
[308.144592,-100.837248,344.252656,-128.37388,1,true],
[279.62184,-109.232968,313.330312,-144.70264000000003,2,true],
[237.19400000000002,-127.614904,284.903784,-158.471704,2,true],
[219.465248,-163.38690400000002,277.36206400000003,-185.817576,2,true],
[228.925016,-184.81564000000003,263.723528,-215.546112,3,false],
[185.67616,-187.25472,217.929376,-223.409904,3,true],
[171.29723199999998,-215.295688,205.10051199999998,-235.01692000000003,4,true],
[168.347,-249.896832,197.201344,-255.028424,4,true],
[164.91816,-272.999936,193.00978400000002,-277.34965600000004,4,true],
[164.028936,-276.714904,182.09131200000002,-305.918496,5,true],
[160.048264,-280.52718400000003,160.072608,-320.74221600000004,5,true],
[158.759048,-279.302184,133.79335999999998,-307.47459200000003,5,true],
[149.30929600000002,-251.199408,115.36516800000001,-287.54344000000003,5,true],
[130.41836,-222.96462400000001,91.809224,-267.86906400000004,6,false],
[104.13392,-188.202472,45.416376,-264.23924800000003,6,true],
[77.652392,-139.846704,5.172504,-237.32318400000003,7,true],
[18.807112,-111.874488,-43.886288,-187.644112,8,true],
[-25.839048,-71.199416,-105.656408,-143.51065599999998,9,true],
[-65.05858400000001,-23.958560000000002,-134.104264,-65.782512,10,false],
[-97.40288000000001,46.03436,-142.492344,28.084616000000004,10,true],
[-134.56707999999998,108.14845600000001,-184.67649600000001,91.254232,10,true],
[-180.046752,176.214128,-241.56848800000003,142.40764000000001,10,true],
[-168.45728,210.104952,-264.41021600000005,205.432312,10,false],
[-154.957784,220.957168,-237.400656,285.18544,10,true],
[-140.216424,234.142816,-162.110096,316.767784,10,true],
[-111.10301600000001,229.25228,-81.445496,311.36165600000004,10,true],
[-81.292552,218.42406400000002,-24.850096,270.61490399999997,10,true],
[-75.595736,211.325392,12.256432,211.240496,10,true],
[-79.754824,203.964672,-25.046488,154.20328,10,true],
[-111.748384,195.370264,-85.83304799999999,155.74,10,true],
[-148.521328,165.783248,-102.454232,147.503952,10,false],
[-138.54350399999998,116.90588000000001,-101.520224,135.620888,10,true],
[-102.895472,72.753968,-79.83508,99.74704,10,true],
[-63.524624,36.340296,-38.988648000000005,68.10580800000001,11,true],
[9.515984000000001,-8.168488,9.32364,63.027680000000004,12,true],
[85.92667200000001,-11.114672,65.110352,72.393552,13,false],
[149.01411199999998,32.13684,82.409472,97.46775199999999,14,true],
[173.407184,88.608912,107.89552800000001,136.292936,14,true],
[198.518,137.794816,154.681184,176.16320000000002,15,true],
[208.861904,147.069456,208.573872,201.781216,15,true],
[220.622328,136.225968,253.016048,182.039872,16,false],
[240.20829600000002,109.857128,290.08228,134.68764000000002,17,true],
[251.84044,81.493928,292.753592,86.474888,17,true],
[261.980096,48.0,295.699656,48.0,17,true]]
var rp = [
[276.457688,40.0,17.2,180.00],
[338.434032,40.0,-95.559568,-135.00],
[278.219032,40.0,-142.16206400000002,-135.00],
[237.18247200000002,40.0,-201.683856,-100.00],
[187.406936,40.0,-227.263376,-165.00],
[146.236984,40.0,-289.34956,-45.00],
[104.01168799999999,40.0,-250.146328,-45.00],
[52.88032,40.0,-166.47048800000002,-60.00],
[-3.9563040000000003,40.0,-130.363992,-45.00],
[-77.52609600000001,40.0,-104.204272,-20.00],
[-99.296368,40.0,-25.846064,-20.00],
[-30.331624,40.083416,45.684839999999994,90.00],
[23.909352,40.0,37.451832,65.00],
[80.92844000000001,40.0,34.355848,35.00],
[136.749936,40.0,113.001752,35.00],
[174.040592,40.0,168.695592,90.00],
[242.180752,40.0,162.593544,155.00],
[275.00572,40.0,99.538408,180.00],
[278.960936,40.0,-6.039928,180.00]]
var startPos = new THREE.Vector3(276.457688,40.0,9.200000000000001)
var startTheta = 3.141592653589793
var trackFile='./tracks/old_sherbet_64/course.glb'
var collisionFile='./tracks/old_sherbet_64/kcl.glb'
var vrFile='./tracks/old_sherbet_64/vrcorn.glb'
var trackName='old_sherbet_64'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
