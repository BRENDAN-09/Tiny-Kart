var shadowFile
var cp = [
[-15.13784,35.68,18.634176,35.68,0,false],
[-15.200000000000001,-25.6,18.400000000000002,-25.6,1,false],
[-33.2,-76.8,18.459416,-57.668856,1,true],
[2.8000000000000003,-117.60000000000001,27.87348,-72.76174400000001,1,true],
[53.2,-117.2,52.823744,-73.162792,1,true],
[108.63030400000001,-141.742768,83.94695200000001,-64.18926400000001,1,true],
[175.385544,-104.00764,87.392296,-57.7292,1,true],
[179.068904,-48.792432000000005,91.83289599999999,-48.781152000000006,1,true],
[162.8,-13.6,91.60000000000001,-13.6,1,false],
[159.20000000000002,31.6,91.806264,13.45332,1,true],
[131.6,94.0,89.60000000000001,20.8,1,true],
[59.2,96.0,85.60000000000001,20.8,1,true],
[21.6,48.800000000000004,83.2,20.400000000000002,1,true],
[33.6,3.2,82.8,3.2,1,true],
[38.16328,-31.590816,80.4,-31.6,1,true],
[38.4,-88.8,75.60000000000001,-88.8,1,true],
[38.729432,-130.40424000000002,75.60000000000001,-130.4,1,true],
[24.391248,-164.51431200000002,123.520472,-164.34532800000002,1,true],
[12.219263999999999,-177.91356,91.695288,-294.158752,1,true],
[-5.211888,-196.892784,-5.147064,-298.27,1,true],
[-46.431056,-205.841752,-46.204576,-259.499704,1,true],
[-77.135456,-202.867376,-124.888616,-256.204768,1,true],
[-85.2,-179.74904800000002,-156.400016,-179.748984,2,false],
[-85.2,-115.60000000000001,-156.4,-115.60000000000001,2,true],
[-84.0,-64.4,-156.4,-64.4,3,true],
[-84.0,-5.2,-156.4,-5.2,3,true],
[-84.0,49.6,-156.8,49.6,3,false],
[-84.4,93.60000000000001,-156.8,93.60000000000001,3,true],
[-80.0,122.4,-128.4,172.8,4,true],
[-48.800000000000004,122.4,-47.6,172.8,4,true],
[12.8,122.4,12.8,172.8,4,true],
[65.2,122.4,65.2,172.8,4,true],
[93.60000000000001,117.2,93.2,166.4,4,true],
[116.4,115.60000000000001,100.0,165.20000000000002,4,true],
[141.20000000000002,117.2,105.2,165.20000000000002,4,true],
[171.20000000000002,166.4,106.0,166.4,4,true],
[139.6,214.8,104.4,168.0,4,true],
[124.4,233.20000000000002,90.8,170.8,4,true],
[121.2,242.0,46.4,177.6,4,false],
[112.4,256.8,33.6,203.6,4,true],
[106.8,278.0,30.400000000000002,231.20000000000002,4,true],
[25.2,327.6,25.6,239.6,5,true],
[-43.2,293.2,22.0,236.8,5,true],
[-82.0,251.6,20.400000000000002,223.20000000000002,5,true],
[-75.2,206.8,19.2,206.8,5,true],
[-20.474536,168.37372,15.6,168.4,5,true],
[-23.2,146.8,19.978488000000002,146.79,5,true],
[-16.0,82.8,18.0,82.8,5,true],
[-16.0,54.800000000000004,18.400000000000002,54.800000000000004,0,true]]
var rp = [
[0.38844799999999996,11.52,44.888,180.00],
[0.0,11.52,-33.495664,180.00],
[-118.16,11.52,-177.58323199999998,0.00],
[-118.16,19.827752,-42.45008,0.00],
[-44.736152000000004,11.342336,149.218816,90.00],
[0.877688,11.52,232.780296,180.00]]
var startPos = new THREE.Vector3(0.532448,11.52,37.288000000000004)
var startTheta = 3.141592653589793
var trackFile='./tracks/old_waluigi_gc/course.glb'
var collisionFile='./tracks/old_waluigi_gc/kcl.glb'
var vrFile='./tracks/old_waluigi_gc/vrcorn.glb'
var trackName='old_waluigi_gc'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
