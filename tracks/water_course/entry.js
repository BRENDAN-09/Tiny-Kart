var shadowFile = 'tracks/water_course/WT_shadow_kaitei.png'
var cp = [
[-53.807264,121.134568,-10.073928,121.12895200000001,0,false],
[-53.76332,40.98684,-10.013496,53.883592,1,false],
[-12.556000000000001,-28.007991999999998,21.122592,-0.6522960000000001,2,true],
[21.90368,-79.583736,74.01075999999999,-48.2736,2,true],
[39.054272,-147.996888,116.384968,-151.774576,2,true],
[24.519232,-206.78518400000002,67.194232,-232.878496,3,false],
[-46.019048000000005,-234.73720000000003,20.421856000000002,-293.821504,4,true],
[-102.83923200000001,-309.38834399999996,-18.550176,-345.00334399999997,5,true],
[-74.85652800000001,-397.519816,-20.47032,-402.505,6,true],
[-69.262528,-426.52259200000003,-27.116232,-488.881752,6,true],
[-74.03632,-424.40168800000004,-137.29516,-503.81509600000004,6,false],
[-92.02832000000001,-365.179592,-193.546312,-434.64084,6,true],
[-130.87148,-292.272624,-235.840528,-362.43756,6,true],
[-160.326112,-246.671,-305.284064,-281.851592,6,true],
[-149.153624,-232.696216,-330.03568800000005,-149.655112,6,true],
[-92.118144,-247.450952,-216.440752,-80.693432,6,false],
[-5.1731679999999995,-207.891216,-129.632016,-95.34716800000001,6,true],
[4.454088,-116.910704,-102.77884,-35.611976000000006,6,true],
[5.076207999999999,-23.647272,-23.168408,-0.7017519999999999,6,true],
[38.928232,21.649919999999998,8.543104,43.30904,6,true],
[70.254336,64.880168,38.99716,89.62531200000001,6,false],
[95.99746400000001,100.32546400000001,85.063776,150.561296,7,true],
[138.18885600000002,82.55868799999999,161.869592,113.697,7,true],
[178.41692,28.382736,203.41537599999998,62.938303999999995,7,true],
[243.38935999999998,-14.982952,234.25316800000002,48.435344,7,true],
[298.80956,58.187784,241.28104800000003,58.099720000000005,7,true],
[252.87279999999998,111.199832,226.92621599999998,79.17992,7,true],
[201.47735999999998,148.377736,178.02147200000002,116.60037600000001,7,true],
[146.554264,187.24244000000002,123.94084,157.562576,7,true],
[92.647992,228.29935999999998,70.23295200000001,198.585424,7,false],
[45.324616000000006,266.97012800000005,18.894088,232.670328,7,true],
[-18.801208,314.122752,-19.408824,254.521904,7,true],
[-88.583584,289.201472,-32.196312,245.98603200000002,8,true],
[-96.25674400000001,208.209816,-23.324688,224.79657600000002,9,false],
[-53.568128,154.949408,-6.923992,160.239408,9,true]]
var rp = [
[-30.140592,120.19968,130.334568,180.00],
[-22.87348,136.578856,30.477512,147.30],
[57.019608,142.102248,-67.30418399999999,162.30],
[50.7806,136.520456,-206.148688,-155.00],
[-9.71256,151.460496,-275.71044,257.30],
[-66.128088,167.018216,-320.796376,172.30],
[-51.186368,192.50156,-394.00544,172.30],
[25.994408,88.68066400000001,252.11395199999998,-52.70],
[-67.33921600000001,98.215256,272.558936,187.30],
[-42.163544,107.33074400000001,200.620888,162.30]]
var startPos = new THREE.Vector3(-30.140592,121.467472,122.334568)
var startTheta = 3.141592653589793
var trackFile='./tracks/water_course/course.glb'
var collisionFile='./tracks/water_course/kcl.glb'
var vrFile='./tracks/water_course/vrcorn.glb'
var trackName='water_course'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
