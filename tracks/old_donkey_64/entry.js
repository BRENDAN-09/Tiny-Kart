var shadowFile = 'tracks/old_donkey_64/d64_shadow.png'
var cp = [
[70.4,65.6,70.4,8.0,0,false],
[48.0,67.2,47.2,7.2,0,false],
[25.6,68.8,28.8,7.2,1,true],
[-15.200000000000001,68.0,20.8,1.6,1,true],
[-30.0,16.0,8.4,-6.4,1,true],
[-44.4,-7.6000000000000005,-4.8,-26.400000000000002,2,true],
[-57.2,-33.2,-15.6,-51.2,2,true],
[-70.8,-60.800000000000004,-26.0,-79.60000000000001,2,true],
[-83.2,-87.60000000000001,-34.800000000000004,-102.8,3,true],
[-90.8,-112.4,-42.0,-121.2,3,false],
[-95.2,-139.6,-43.6,-142.4,3,true],
[-94.8,-161.6,-49.6,-161.20000000000002,4,true],
[-88.8,-188.0,-52.0,-176.0,4,true],
[-82.0,-204.0,-50.800000000000004,-186.8,4,true],
[-69.2,-225.20000000000002,-43.2,-202.0,5,true],
[-52.800000000000004,-237.6,-38.4,-212.0,5,true],
[-32.8,-244.4,-28.8,-223.6,5,true],
[-15.200000000000001,-247.20000000000002,-18.0,-223.6,5,true],
[8.8,-244.4,-3.6,-222.4,5,true],
[31.2,-223.6,6.0,-213.20000000000002,5,true],
[36.4,-200.0,9.6,-200.0,5,true],
[30.400000000000002,-174.8,5.6000000000000005,-184.8,5,true],
[10.0,-156.0,-1.6,-176.4,5,false],
[-13.6,-154.0,-12.4,-174.4,5,true],
[-37.2,-164.4,-25.6,-182.0,6,true],
[-56.0,-181.20000000000002,-45.6,-196.4,6,true],
[-70.4,-192.4,-60.0,-206.8,6,true],
[-88.8,-204.8,-73.2,-228.0,6,true],
[-110.4,-212.4,-82.8,-249.20000000000002,6,true],
[-133.6,-222.8,-96.0,-274.0,6,true],
[-161.20000000000002,-236.8,-119.2,-298.8,6,true],
[-191.6,-256.0,-143.6,-322.0,6,true],
[-193.6,-256.8,-200.4,-349.6,6,true],
[-195.6,-257.2,-249.6,-331.6,6,true],
[-197.20000000000002,-256.0,-259.6,-263.6,6,true],
[-196.0,-231.20000000000002,-250.4,-227.20000000000002,7,true],
[-195.6,-204.0,-247.6,-203.20000000000002,7,true],
[-195.20000000000002,-178.4,-242.4,-176.4,7,true],
[-193.6,-151.6,-239.20000000000002,-150.8,8,true],
[-192.4,-126.8,-234.8,-123.60000000000001,8,true],
[-191.6,-107.2,-236.0,-104.8,9,false],
[-183.6,-31.6,-240.4,-101.60000000000001,9,true],
[-245.20000000000002,-41.6,-253.20000000000002,-100.8,9,true],
[-269.2,-42.0,-280.0,-99.2,9,true],
[-270.4,-39.6,-333.6,-83.60000000000001,9,true],
[-271.6,-30.400000000000002,-329.6,-30.400000000000002,9,true],
[-269.6,10.0,-328.40000000000003,10.0,9,true],
[-267.2,43.6,-326.8,43.6,9,true],
[-265.2,72.0,-326.0,80.4,9,true],
[-259.2,78.8,-318.40000000000003,110.0,9,true],
[-256.4,80.8,-289.2,138.4,9,true],
[-252.8,82.8,-248.4,142.8,9,true],
[-242.8,79.60000000000001,-226.8,133.6,9,true],
[-214.0,68.4,-198.8,118.4,9,true],
[-186.0,59.2,-174.0,108.0,9,true],
[-158.0,52.4,-167.6,108.0,10,true],
[-128.4,66.0,-164.4,109.2,10,true],
[-106.0,98.8,-157.6,114.4,10,true],
[-110.4,139.20000000000002,-161.20000000000002,120.0,10,true],
[-138.8,170.4,-183.6,137.20000000000002,10,true],
[-170.4,197.20000000000002,-217.20000000000002,159.20000000000002,10,true],
[-180.8,211.20000000000002,-242.0,196.0,10,true],
[-186.0,219.6,-245.6,229.20000000000002,10,true],
[-184.4,227.20000000000002,-228.4,263.6,10,true],
[-176.0,232.8,-198.0,280.0,10,true],
[-145.6,237.6,-153.20000000000002,285.6,10,true],
[-103.2,240.4,-103.2,285.6,10,true],
[-65.2,240.4,-58.0,284.0,10,true],
[-43.6,230.4,-18.0,270.8,10,true],
[-28.8,209.20000000000002,16.8,242.0,11,false],
[-22.400000000000002,186.8,44.800000000000004,198.8,11,true],
[10.8,168.4,22.0,170.4,11,true],
[14.8,140.0,27.6,141.6,11,true],
[12.8,110.4,33.6,114.8,11,true],
[18.400000000000002,87.60000000000001,44.800000000000004,108.8,11,true],
[37.6,64.0,52.800000000000004,105.60000000000001,11,false],
[62.4,59.2,64.8,104.8,11,true],
[85.60000000000001,63.2,76.0,104.8,11,true],
[111.60000000000001,79.60000000000001,90.4,111.2,11,true],
[122.8,93.2,106.0,119.60000000000001,11,true],
[135.2,102.0,122.8,130.4,11,true],
[146.0,104.8,146.4,138.8,11,true],
[152.4,100.8,179.20000000000002,129.6,11,true],
[154.0,93.2,191.20000000000002,96.8,11,true],
[147.20000000000002,83.2,175.20000000000002,58.800000000000004,11,true],
[136.0,76.8,158.4,45.6,11,true],
[126.4,72.0,141.6,33.6,11,true],
[109.60000000000001,68.0,120.0,13.6,11,true],
[88.8,64.8,88.8,7.2,0,true]]
var cannonDest = new THREE.Vector3(0.0,0.0,0.0)
var cannonDest = new THREE.Vector3(-184.8,35.857168,-284.8)
var rp = [
[79.456456,35.057168,43.59464,-90.00],
[11.6,35.057168,43.6,-135.00],
[-33.6,35.055208,-17.6,-155.00],
[-70.4,35.05716,-94.0,-160.00],
[-81.60000000000001,35.05716,-162.8,176.00],
[-56.800000000000004,35.05716,-222.4,120.00],
[-35.2,39.13572,-174.8,-130.00],
[-210.0,35.057168,-214.4,1.00],
[-208.0,35.057168,-149.6,5.00],
[-202.4,35.057168,-88.8,-30.00],
[-128.8,40.09472,96.8,-5.00],
[9.6,9.701808000000002,200.8,170.00]]
var startPos = new THREE.Vector3(71.57600000000001,35.057168,43.424)
var startTheta = -1.5707963267948966
var trackFile='./tracks/old_donkey_64/course.glb'
var collisionFile='./tracks/old_donkey_64/kcl.glb'
var vrFile='./tracks/old_donkey_64/vrcorn.glb'
var trackName='old_donkey_64'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
