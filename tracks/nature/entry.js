var cp = [
[-57.121024,441.80128,-57.230216,500.847752],
[-4.976,441.24472,-4.976,507.491688],
[47.92656,437.983376,48.336064,506.00416],
[208.640952,420.38544,208.687592,505.40312800000004],
[247.49056000000002,418.428816,247.42056,496.92328000000003],
[285.79790399999996,418.214968,294.97416,507.11071999999996],
[290.538248,417.882312,376.96272,510.085592],
[291.102872,416.97672,438.95056,471.35159200000004],
[290.83144,415.70656,440.530096,395.444096],
[290.22184000000004,414.89144,381.38072,327.71544],
[289.320624,414.677752,324.471376,324.436312],
[273.34775199999996,413.97816,273.01984000000004,327.647128],
[208.08679999999998,413.671128,271.077752,326.685376],
[156.96656,391.17809600000004,269.706248,324.815128],
[132.57592000000002,342.087376,268.387752,323.083528],
[138.556,285.039688,267.68009600000005,321.20631199999997],
[175.985768,236.143128,268.726472,317.177032],
[244.270872,230.577128,272.922,313.002816],
[304.42328000000003,235.04520000000002,304.386408,293.60368800000003],
[342.17144,240.00672,341.88584000000003,291.15687199999996],
[350.611904,239.868952,416.869592,298.46168800000004],
[352.38462400000003,237.086872,459.269904,271.287752],
[351.481376,229.42064000000002,456.78103200000004,228.36544],
[352.05262400000004,220.936952,457.364872,181.79872],
[347.446968,215.408952,417.737184,133.401128],
[329.065184,220.874488,328.44584000000003,134.554408],
[284.78712800000005,229.60608,283.60512800000004,131.60136],
[246.38320000000002,229.27256,245.575688,133.235512],
[198.711688,217.92223199999998,197.07104800000002,141.18807999999999],
[164.008,229.608,107.48872,145.32064000000003],
[150.03184,254.18944000000002,76.02279200000001,169.611768],
[109.23504,302.79344000000003,74.52728,169.65664],
[31.813384,308.75928000000005,73.223888,170.632408],
[-23.001304,249.14472,72.578184,170.194408],
[-21.761928,141.16464000000002,70.85368,140.6672],
[-13.589944,46.79255200000001,51.856888,45.992376],
[-9.620504,-5.230055999999999,61.376160000000006,34.902055999999995],
[39.747096,-42.001904,72.673784,31.515424],
[89.13712,-48.530472,89.13712,28.960776000000003],
[129.288,-50.23155200000001,128.25856,29.326984],
[172.181768,-51.249288,172.47095199999998,28.319112],
[209.11679999999998,-53.048976,209.514,25.829608],
[293.476,-50.2072,293.38072,40.21932],
[339.59959200000003,-50.73368,341.51528,48.595616],
[376.447184,-54.823784,391.979904,48.043496],
[399.61271999999997,-64.396744,449.99568800000003,31.608952000000002],
[421.73031199999997,-85.47424000000001,513.666408,-12.091536],
[432.42609600000003,-110.39576,549.953816,-82.77968],
[427.17544000000004,-136.17808,553.634184,-153.595592],
[416.38944000000004,-154.87992000000003,528.107064,-230.20128],
[395.66784,-172.88359200000002,460.53887199999997,-289.78272],
[359.937032,-184.111688,392.623032,-298.52656],
[312.56584000000004,-185.35848800000002,338.35071999999997,-301.12744000000004],
[53.630736,44.931648,84.27472,124.29552000000001],
[95.03312,31.282080000000004,109.06632,116.28344],
[147.557512,30.881135999999998,148.760408,113.87776],
[190.058232,30.881135999999998,204.492408,110.2692],
[213.92000000000002,28.079248,267.842408,88.61792],
[219.130408,10.6346,299.918408,43.310576000000005],
[217.3228,-16.029992,302.32416,-16.029992],
[221.332232,-68.95536,299.11656,-68.554416],
[223.6128,-96.48672,299.22062400000004,-96.6288],
[223.50176800000003,-123.2212,299.082,-123.7932],
[231.037512,-299.982408,334.064472,-316.25024800000006],
[225.465688,-331.92512800000003,332.564096,-390.215592],
[215.185688,-333.02184000000005,332.858,-504.891592],
[207.931768,-332.913032,256.927512,-524.6540640000001],
[195.58544,-331.262472,194.74559200000002,-516.7782480000001],
[205.819128,-129.3252,230.0612,-165.59576800000002],
[194.273592,-151.319048,223.718872,-172.7308],
[187.62792000000002,-180.82808,222.40800000000002,-180.792],
[186.53656,-210.649128,223.36264000000003,-210.21064],
[176.494408,-242.19935999999998,228.00279999999998,-247.409048],
[157.444488,-264.20144,229.769128,-307.72512800000004],
[139.520408,-318.852872,196.10728,-330.49344],
[136.19008,-323.48990399999997,115.81328,-528.279688],
[132.003048,-325.65728,54.24944000000001,-511.895592],
[127.8228,-323.99728000000005,33.36132,-437.289528],
[125.2432,-318.462472,25.850392,-359.997752],
[109.04384,-271.711904,31.74544,-324.820624],
[66.655616,-232.7728,16.958448,-307.36016],
[10.701696,-196.62792000000002,-7.856592,-323.19671999999997],
[-50.861968000000005,-188.48536,-60.224136,-321.200408],
[-109.09224,-193.26736,-109.59952000000001,-315.83409600000005],
[-148.654,-197.26407999999998,-191.46264000000002,-356.344872],
[-161.533688,-191.861688,-272.924968,-306.55528000000004],
[-162.15264000000002,-168.42016,-266.692472,-168.39600000000002],
[-159.629048,-114.80432,-265.592,-113.21952],
[-165.81807999999998,-60.259976,-259.5632,-59.313320000000004],
[-178.41856,-10.239824,-245.240872,-10.164952],
[-185.998952,25.968032,-231.25648800000002,25.998687999999998],
[-179.90495199999998,56.612392,-240.489688,33.354983999999995],
[-181.170952,144.17520000000002,-248.04264,37.642704],
[-241.60104800000002,161.96344000000002,-257.320872,40.921048000000006],
[-284.546968,161.51016,-285.09712800000005,46.691112000000004],
[-326.262,176.354,-341.987184,-9.016856],
[-342.736,165.92664000000002,-402.67528000000004,-16.00176],
[-348.27368800000005,169.71792000000002,-503.09928,-13.538768000000001],
[-351.59056,176.71456,-526.3703760000001,65.170096],
[-352.698816,183.154312,-489.715592,180.56087200000002],
[-330.141752,224.69023199999998,-487.37968800000004,223.278312],
[-328.447592,266.539032,-486.637752,267.045376],
[-328.840872,318.064248,-490.556,316.474968],
[-361.39856000000003,355.131376,-502.856408,345.68118400000003],
[-359.578968,381.408968,-510.26009600000003,405.242968],
[-360.173376,386.31768800000003,-456.256312,475.62462400000004],
[-359.266,390.370312,-388.40128000000004,485.253592],
[-324.86912800000005,416.88009600000004,-324.15744,464.86],
[-284.64072,419.01016,-283.958,468.407688],
[-243.72808,418.77344,-243.606488,468.282],
[-194.82808,418.40000000000003,-195.289768,469.517688],
[-161.55007999999998,418.524816,-162.10456,505.922312],
[-145.37120000000002,417.51224800000006,-116.44872000000001,502.81384],
[-137.29272,414.233128,-92.93032000000001,457.363184],
[-91.05184,323.26703200000003,-90.8572,448.388872],
[-58.133264000000004,324.54328000000004,-57.506440000000005,439.580968],
[-26.916352,330.136312,-24.999599999999997,439.165592],
[10.178272000000002,329.976816,9.922,439.128624],
[63.03172,330.778872,29.8942,438.112408],
[119.70096000000001,358.444408,49.08196,443.398968],
[138.46216,387.53918400000003,66.517008,479.865528],
[152.35872,400.65672,108.58064,497.63209600000005],
[172.3228,410.79672,157.08216000000002,514.171688],
[190.75207999999998,415.56672,191.10608,506.82216],
[-324.291184,469.33544,-368.605376,495.521032],
[-312.205528,472.356816,-330.334,523.720968],
[-301.67056,472.695688,-292.01800000000003,522.902],
[-293.03528000000006,469.875528,-260.95023199999997,505.525528],
[-285.19231199999996,463.45847200000003,-246.69023199999998,474.86647200000004],
[-290.89631199999997,426.382408,-238.84728,427.808408],
[-283.76631199999997,389.306408,-236.70823199999998,419.252408],
[-258.81128,362.212408,-230.2912,409.98344000000003],
[-223.1612,347.952408,-221.022232,406.418408],
[-180.3812,345.813376,-180.3812,403.566408],
[-139.74016,347.239376,-139.74016,402.140408]]
var startPos = new THREE.Vector3(-15.021576,53.524080000000005,457.317752)
var startTheta = 1.5707963267948966
var startPos = new THREE.Vector3(208.80856,53.524080000000005,456.78121600000003)
var startTheta = 1.5707963267948966
var trackFile='./tracks/nature/course.glb'
var collisionFile='./tracks/nature/kcl.glb'
var vrFile='./tracks/nature/vrcorn.glb'
var trackName='nature'
var numLaps = 3
var floorName = []
var wallName = []
var water, swater, cube, boost
var boosts = []
var materials = [];
var floor = []
var walls = []
var trackShadow
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000)
//camera.layers.set(5)


var rp = []
//Initiate the THREE js context
scene = new THREE.Scene()


loader = new THREE.GLTFLoader()
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(false&&(node instanceof THREE.Mesh && node.geometry.attributes.uv2)){
      console.log(`${node.name} has 2 uvs`);
      node.material = material
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root);
  count(3)
  finalize();
  animate()
});

loader.load(collisionFile,function(gltf,err){
  console.log(err);
  root = gltf.scene;
  root.traverse(function(node){
    if(node.name[0]=="r"||node.name[0]=="o"){
      node.name = node.name.toUpperCase();
      floor.push(node);
    }
    if(node.name.substring(0,4)=="fall"){
      node.name = "D" + node.name;
      floor.push(node);
    }
    if(node.name[0]=="w"){
      walls.push(node);
    }
    if(node.name.substring(0,4)=='fast'){
      node.name = "B" + node.name
      boosts.push(node.name);
      floor.push(node);
    }
    node.layers.set(5);
  })
  scene.add(root)
})

loader.load(vrFile,function(gltf,err){
  console.log(err);
  gltf.scene.traverse(function(node){
    if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(gltf.scene);
})


function finalize(){
}

function update(){

}
