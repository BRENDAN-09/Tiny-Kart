var shadowFile = 'tracks/boardcross_course/dkshade070810_a.png'
var cp = [
[23.826888,-32.421544000000004,23.79072,34.957968,1,false],
[47.722488,-29.990536000000002,48.721672,36.603480000000005,1,false],
[95.928104,-30.094936,91.895632,36.232168,1,true],
[149.440752,-19.909344,98.515664,35.737712,1,true],
[172.68516,19.308376,103.484832,37.336368,1,true],
[169.34216,53.062456,107.868944,53.504712,1,true],
[170.226656,83.135688,107.868944,86.231464,1,true],
[167.201888,717.9384960000001,103.004168,719.980496,3,true],
[164.03512800000001,743.419936,99.973888,748.590496,3,true],
[164.463168,763.04544,101.235152,784.107248,3,true],
[170.65472,782.5045600000001,117.156264,813.295936,3,true],
[183.037816,792.234128,148.55624799999998,848.234,3,true],
[190.432376,796.5045600000001,198.088624,853.541,3,true],
[198.392936,789.4284960000001,240.10270400000002,834.9663760000001,3,true],
[199.415392,782.7804960000001,264.86887199999995,791.183312,3,true],
[201.626656,763.7635600000001,270.61818400000004,762.436816,3,true],
[198.53087200000002,711.1354399999999,272.387184,709.808688,3,true],
[195.435112,658.9495039999999,276.367472,655.853752,3,true],
[194.74562400000002,609.06544,277.251968,609.8593760000001,3,true],
[193.561688,583.271936,277.512968,573.73744,4,true],
[193.31447200000002,570.551064,264.297528,523.268344,4,true],
[182.752576,552.613688,234.79565599999998,497.084784,4,true],
[147.671752,530.253816,212.682984,465.684784,4,true],
[96.176376,501.692344,179.07173600000002,428.09321600000004,4,true],
[63.148904,478.509904,146.787232,402.00028000000003,4,false],
[27.632,448.825688,109.78395200000001,372.864656,0,true],
[-9.570152,413.568216,53.610816,353.395312,0,true],
[-31.86504,385.472936,24.975464,331.81087199999996,0,true],
[-46.025112,361.35924800000004,13.008376,324.65831199999997,0,true],
[-57.264656,304.45524800000004,12.98164,324.61550400000004,0,true],
[-25.273048,268.996592,13.004288,324.59706400000005,0,true],
[12.773056,267.443376,13.039216000000001,324.610184,0,true],
[34.318648,274.35624800000005,14.780840000000001,327.79571999999996,0,true],
[56.22122400000001,288.113904,37.764896,345.318816,0,true],
[71.86638400000001,296.54924800000003,61.687224,357.57347200000004,0,true],
[80.328704,301.30012800000003,91.12881600000001,365.583784,2,true],
[80.427904,301.30531199999996,117.10966400000001,348.484376,2,true],
[80.466984,301.272936,141.42318400000002,313.58493599999997,2,true],
[80.44675199999999,301.214376,139.30373600000001,290.42756,2,true],
[80.360608,301.165344,135.540296,274.515784,2,true],
[54.450544,291.512312,117.886408,249.92209599999998,2,true],
[34.965248,277.813312,99.96030400000001,227.403184,2,true],
[15.64308,265.10609600000004,81.774224,207.849488,2,true],
[-33.33423200000001,228.84992000000003,31.194992,165.254264,2,false],
[-77.41681600000001,193.86816000000002,-10.825544,128.427224,2,true],
[-121.512504,154.643248,-58.312704,86.761992,1,true],
[-159.432392,120.70261599999999,-74.463768,65.69539200000001,1,true],
[-177.221952,81.84644800000001,-87.3378,56.098384,1,true],
[-187.053032,38.308816,-94.12592,47.437672,1,true],
[-175.115296,-5.931048,-94.36,38.77696,1,true],
[-121.512496,-34.722063999999996,-89.91260000000001,31.754759999999997,1,false],
[-77.974864,-32.147256,-78.67708800000001,30.584392,1,true],
[-51.99272800000001,-32.147256,-50.354216,34.56364,1,true],
[-7.752872000000001,-32.381336,-10.795824000000001,34.095496,1,true],
[10.545928,-31.849152,10.525200000000002,35.250064,1,true]]
var cannonDest = new THREE.Vector3(134.982752,340.0,717.1750000000001)
var rp = [
[24.691176,122.4,297.30215999999996,36.00],
[20.839424,4.153608,0.488912,90.00],
[95.25768,77.60000000000001,258.726064,-126.00],
[137.889328,321.065064,786.6028719999999,15.00],
[190.89106400000003,210.581704,511.974496,-125.00]]
var startPos = new THREE.Vector3(20.700048,4.153608,0.8192240000000001)
var startTheta = 1.5707963267948966
var trackFile='./tracks/boardcross_course/course.glb'
var collisionFile='./tracks/boardcross_course/kcl.glb'
var vrFile='./tracks/boardcross_course/vrcorn.glb'
var trackName='boardcross_course'
var numLaps = 3
var floor = []
var walls = []
var collision = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000000000)
loader = new THREE.GLTFLoader();
scene = new THREE.Scene()

var texLoad = new THREE.TextureLoader(), shadowMap
if(shadowFile!=undefined)shadowMap = texLoad.load(shadowFile)
//load model
loader.load(trackFile, function(gltf, err) {
  console.log(err);
  root = gltf.scene;
  gltf.scene.traverse(function(node) {
    if(shadowMap!=undefined&& node instanceof THREE.Mesh && node.geometry.attributes.uv2){
      console.log(`${node.name} has 2 uvs`);
      node.material = shadowMat(node.material.map,shadowMap);
    }else if (node instanceof THREE.Mesh){
      node.material = flatMat(node.material.map);
    }
  })
  scene.add(root)
  count(3)
  finalize()
  animate()
});

//load collision and bg
loadKcl(collisionFile)
loadVrcorn(vrFile)


function finalize(){

}
//called every frame
function update(){

}
